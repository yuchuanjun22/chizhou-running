<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ± å·æ‚¦è·‘å›¢ - è·‘æ­¥æ‰“å¡ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.13.2/dist/av-min.js"></script>
    <style>
        /* æ‰€æœ‰CSSæ ·å¼ä¿æŒä¸å˜ï¼Œä¸æ‚¨æä¾›çš„ä»£ç ç›¸åŒ */
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --accent: #e74c3c;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --night-run: #667eea;
            --soul-run: #9b59b6;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        /* å…¶ä½™CSSæ ·å¼ä¿æŒä¸å˜ */
        header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        .logo {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            background-color: var(--light);
        }
        
        @media (min-width: 768px) {
            .dashboard {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .form-container {
            padding: 20px 30px;
            background-color: var(--light);
            border-bottom: 1px solid #e0e0e0;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .pace-calculator {
            background: #e8f4fc;
            padding: 10px;
            border-radius: 6px;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        .pace-result {
            font-weight: bold;
            color: var(--primary);
            margin-left: 5px;
        }
        
        .feeling-custom {
            margin-top: 5px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-success {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-danger {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-night {
            background: linear-gradient(135deg, var(--night-run), #764ba2);
            color: white;
        }
        
        .btn-soul {
            background: linear-gradient(135deg, var(--soul-run), #8e44ad);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
            padding: 20px 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        th {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .night-run-header {
            background: linear-gradient(90deg, var(--night-run), #764ba2);
        }
        
        .soul-run-header {
            background: linear-gradient(90deg, var(--soul-run), #8e44ad);
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tr:nth-child(even) {
            background-color: var(--light);
        }
        
        tr:hover {
            background-color: #e8f4fc;
        }
        
        .ranking-badge {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .ranking-badge.gold {
            background: var(--gold);
        }
        
        .ranking-badge.silver {
            background: var(--silver);
        }
        
        .ranking-badge.bronze {
            background: var(--bronze);
        }
        
        .ranking-badge.night {
            background: var(--night-run);
        }
        
        .ranking-badge.soul {
            background: var(--soul-run);
        }
        
        .feeling-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .feeling-excellent {
            background-color: #e8f6f3;
            color: #27ae60;
        }
        
        .feeling-good {
            background-color: #eaf2f8;
            color: #2980b9;
        }
        
        .feeling-normal {
            background-color: #fef9e7;
            color: #f39c12;
        }
        
        .feeling-tired {
            background-color: #fdedec;
            color: #e74c3c;
        }
        
        .feeling-custom-style {
            background-color: #f0e6ff;
            color: #8e44ad;
        }
        
        .time-type-badge {
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
            text-align: center;
            min-width: 60px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .morning-run {
            background: linear-gradient(135deg, #ff9a00, #ff6a00);
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .night-run {
            background: linear-gradient(135deg, var(--night-run), #764ba2);
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .night-runner-title {
            display: inline-block;
            background: linear-gradient(135deg, var(--night-run), #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .soul-runner-title {
            display: inline-block;
            background: linear-gradient(135deg, var(--soul-run), #8e44ad);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(155, 89, 182, 0.3);
            animation: soul-glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            }
            to {
                box-shadow: 0 3px 20px rgba(102, 126, 234, 0.6);
            }
        }
        
        @keyframes soul-glow {
            from {
                box-shadow: 0 3px 10px rgba(155, 89, 182, 0.3);
            }
            to {
                box-shadow: 0 3px 20px rgba(155, 89, 182, 0.6);
            }
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        
        .data-management {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .data-management h3 {
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .import-export-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-label:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .import-format {
            background: #fff9e6;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 4px solid #f39c12;
        }
        
        .import-format h4 {
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .import-format pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 14px;
        }
        
        footer {
            background: linear-gradient(90deg, var(--dark), #34495e);
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.95rem;
        }
        
        .footer-text {
            margin-bottom: 5px;
        }
        
        .footer-slogan {
            font-style: italic;
            opacity: 0.8;
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .message.success {
            background-color: var(--secondary);
        }
        
        .message.error {
            background-color: var(--accent);
        }
        
        .message.show {
            transform: translateX(0);
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--gray);
            font-style: italic;
        }
        
        .night-runner-section, .soul-runner-section {
            background: linear-gradient(135deg, #f0f4ff, #e6f0ff);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid var(--night-run);
        }
        
        .soul-runner-section {
            background: linear-gradient(135deg, #f8f0ff, #f0e6ff);
            border-left: 5px solid var(--soul-run);
        }
        
        .night-runner-title-main, .soul-runner-title-main {
            font-size: 1.5rem;
            color: var(--night-run);
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .soul-runner-title-main {
            color: var(--soul-run);
        }
        
        .night-runner-grid, .soul-runner-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .night-runner-card, .soul-runner-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .soul-runner-card {
            box-shadow: 0 3px 10px rgba(155, 89, 182, 0.1);
        }
        
        .night-runner-card.top, .soul-runner-card.top {
            border-color: var(--night-run);
            transform: scale(1.05);
        }
        
        .soul-runner-card.top {
            border-color: var(--soul-run);
        }
        
        .night-runner-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .soul-runner-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.2);
        }
        
        .night-runner-name, .soul-runner-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .night-runner-stats, .soul-runner-stats {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .feeling-text {
            font-style: italic;
            margin-top: 5px;
            color: var(--dark);
        }

        /* å‚ä¸äººå‘˜ç›¸å…³æ ·å¼ */
        .clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clickable:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .runners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .runner-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .runner-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .runner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .runner-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--dark);
        }

        .runner-rank {
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .runner-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 2px;
        }

        .runner-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .detail-label {
            color: var(--gray);
        }

        .detail-value {
            font-weight: 500;
        }

        .top-runner {
            border-left-color: var(--gold);
            background: linear-gradient(135deg, #fff9e6, #fff);
        }

        .runner-badges {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .badge-night {
            background: var(--night-run);
            color: white;
        }

        .badge-soul {
            background: var(--soul-run);
            color: white;
        }

        .badge-consistent {
            background: var(--secondary);
            color: white;
        }

        .badge-fast {
            background: var(--accent);
            color: white;
        }

        .badge-sponsor-gold {
            background: var(--gold);
            color: black;
        }

        .badge-sponsor-silver {
            background: var(--silver);
            color: black;
        }

        .badge-sponsor-bronze {
            background: var(--bronze);
            color: white;
        }

        /* èµ„é‡‘ç®¡ç†æ ·å¼ */
        .funds-summary {
            background: linear-gradient(135deg, #f0f8ff, #e6f7ff);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .funds-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .funds-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .funds-actions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .sponsor-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .funds-records {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .usage-plan {
            background: #fff9e6;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
        }

        .usage-plan ul {
            list-style: none;
            padding: 0;
        }

        .usage-plan li {
            padding: 8px 0;
            font-size: 1rem;
        }

        .sponsor-record {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .sponsor-record:last-child {
            border-bottom: none;
        }

        .sponsor-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sponsor-amount {
            font-weight: bold;
            color: var(--secondary);
        }

        .sponsor-date {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* æ¿€åŠ±æªæ–½æ ·å¼ */
        .rewards-section {
            background: linear-gradient(135deg, #fff0f5, #ffe4e6);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #e91e63;
        }

        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .reward-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .reward-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .reward-card.premium {
            border-color: var(--gold);
            background: linear-gradient(135deg, #fff9e6, #fff);
        }

        .reward-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .reward-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark);
        }

        .reward-level {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .level-basic {
            background: var(--primary);
            color: white;
        }

        .level-premium {
            background: var(--gold);
            color: black;
        }

        .reward-description {
            color: var(--gray);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .reward-benefits {
            list-style: none;
            padding: 0;
        }

        .reward-benefits li {
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reward-benefits li:before {
            content: "âœ“";
            color: var(--secondary);
            font-weight: bold;
        }

        .points-system {
            background: linear-gradient(135deg, #e8f5e8, #d0f0d0);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
        }

        .points-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .points-table th {
            background: var(--secondary);
        }

        .points-table td {
            padding: 12px;
            text-align: center;
        }

        .points-table tr:nth-child(even) {
            background: #f8fff8;
        }
        
        /* ç¼–è¾‘åŒºåŸŸæ ·å¼ */
        .editable-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px dashed #ddd;
        }
        
        .editable-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .edit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .save-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .cancel-btn {
            background: var(--gray);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .editable-textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            resize: vertical;
        }
        
        .usage-record-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .usage-record {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            background: white;
            margin-bottom: 10px;
            border-radius: 6px;
        }
        
        .usage-record:last-child {
            border-bottom: none;
        }
        
        .usage-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .usage-amount {
            font-weight: bold;
            color: var(--accent);
        }
        
        .usage-date {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .usage-description {
            color: var(--dark);
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                padding: 12px 15px;
                border-bottom: 1px solid #e0e0e0;
            }
            
            .tab.active {
                border-bottom: 3px solid var(--primary);
            }
            
            .logo {
                position: static;
                transform: none;
                margin-bottom: 10px;
            }
            
            header {
                text-align: center;
            }
            
            .import-export-options {
                flex-direction: column;
            }
            
            .night-runner-grid, .soul-runner-grid {
                grid-template-columns: 1fr;
            }

            .runners-grid {
                grid-template-columns: 1fr;
            }

            .runner-stats {
                grid-template-columns: 1fr 1fr;
            }

            .funds-stats {
                grid-template-columns: 1fr;
            }

            .sponsor-options {
                flex-direction: column;
            }

            .rewards-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* æ·»åŠ åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            font-size: 1.2rem;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div>æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...</div>
    </div>
    
    <div class="container">
        <header>
            <div class="logo">ğŸƒâ€â™‚ï¸ æ± å·æ‚¦è·‘å›¢</div>
            <h1>è·‘æ­¥æ‰“å¡ç³»ç»Ÿ</h1>
            <p class="subtitle">å¥åº·ç”Ÿæ´»ï¼Œä»è·‘æ­¥å¼€å§‹</p>
        </header>
        
        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-value" id="totalRuns">0</div>
                <div class="stat-label">æ€»è·‘æ­¥æ¬¡æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalDistance">0 km</div>
                <div class="stat-label">æ€»é‡Œç¨‹</div>
            </div>
            <div class="stat-card clickable" id="runnersCard">
                <div class="stat-value" id="totalRunners">0</div>
                <div class="stat-label">å‚ä¸äººæ•° <small>(ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…)</small></div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgPace">0:00</div>
                <div class="stat-label">å¹³å‡é…é€Ÿ</div>
            </div>
        </div>
        
        <div class="form-container">
            <h2 style="margin-bottom: 15px; color: var(--dark);">ä»Šæ—¥æ‰“å¡</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="runnerName">è·‘æ­¥è€…å§“å</label>
                    <input type="text" id="runnerName" class="form-control" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                </div>
                <div class="form-group">
                    <label for="runDate">è·‘æ­¥æ—¥æœŸ</label>
                    <input type="date" id="runDate" class="form-control">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="runDistance">è·‘æ­¥é‡Œç¨‹ (km)</label>
                    <input type="number" id="runDistance" class="form-control" placeholder="ä¾‹å¦‚ï¼š5.2" step="0.1" min="0">
                </div>
                <div class="form-group">
                    <label for="runTime">è·‘æ­¥æ—¶é•¿ (åˆ†é’Ÿ)</label>
                    <input type="number" id="runTime" class="form-control" placeholder="ä¾‹å¦‚ï¼š28" min="0">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="runPace">è·‘æ­¥é…é€Ÿ (åˆ†é’Ÿ/å…¬é‡Œ)</label>
                    <input type="text" id="runPace" class="form-control" placeholder="è‡ªåŠ¨è®¡ç®—" readonly>
                    <div class="pace-calculator">
                        é…é€Ÿè®¡ç®—: <span id="paceResult" class="pace-result">--:--</span>
                        <small style="color: var(--gray); display: block; margin-top: 5px;">
                            æ ¹æ®é‡Œç¨‹å’Œæ—¶é•¿è‡ªåŠ¨è®¡ç®—
                        </small>
                    </div>
                </div>
                <div class="form-group">
                    <label for="runFeeling">è·‘æ­¥æ„Ÿå—</label>
                    <select id="runFeeling" class="form-control">
                        <option value="ç²¾åŠ›å……æ²›">ç²¾åŠ›å……æ²›</option>
                        <option value="çŠ¶æ€è‰¯å¥½">çŠ¶æ€è‰¯å¥½</option>
                        <option value="æ­£å¸¸" selected>æ­£å¸¸</option>
                        <option value="æœ‰ç‚¹ç–²æƒ«">æœ‰ç‚¹ç–²æƒ«</option>
                        <option value="custom">è‡ªå®šä¹‰æ„Ÿå—...</option>
                    </select>
                    <input type="text" id="customFeeling" class="form-control feeling-custom" placeholder="è¯·è¾“å…¥æ‚¨çš„æ„Ÿå—..." style="display: none;">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="runType">è·‘æ­¥æ—¶é—´</label>
                    <select id="runType" class="form-control">
                        <option value="æ™¨è·‘">æ™¨è·‘</option>
                        <option value="å¤œè·‘">å¤œè·‘</option>
                    </select>
                </div>
                <div class="form-group" style="display: flex; align-items: flex-end;">
                    <button id="addRecordBtn" class="btn btn-success" style="width: 100%;">
                        æäº¤æ‰“å¡
                    </button>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="weekly">å‘¨æ’å</div>
            <div class="tab" data-tab="monthly">æœˆæ’å</div>
            <div class="tab" data-tab="yearly">å¹´æ’å</div>
            <div class="tab" data-tab="pace">é…é€Ÿæ¦œ</div>
            <div class="tab" data-tab="night">å¤œè·‘æ¦œ</div>
            <div class="tab" data-tab="soul">å¿ƒçµè·‘è€…</div>
            <div class="tab" data-tab="consistency">åšæŒå¤©æ•°æ¦œ</div>
            <div class="tab" data-tab="runners">å‚ä¸äººå‘˜</div>
            <div class="tab" data-tab="rewards">æ¿€åŠ±æªæ–½</div>
            <div class="tab" data-tab="funds">å›¢é˜Ÿèµ„é‡‘</div>
            <div class="tab" data-tab="records">æ‰“å¡è®°å½•</div>
            <div class="tab" data-tab="charts">æ•°æ®å›¾è¡¨</div>
            <div class="tab" data-tab="data-management">æ•°æ®ç®¡ç†</div>
        </div>
        
        <div class="tab-content active" id="weekly-tab">
            <h2>æœ¬å‘¨è·‘æ­¥æ’å</h2>
            <div id="weeklyContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="monthly-tab">
            <h2>æœ¬æœˆè·‘æ­¥æ’å</h2>
            <div id="monthlyContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="yearly-tab">
            <h2>æœ¬å¹´è·‘æ­¥æ’å</h2>
            <div id="yearlyContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="pace-tab">
            <h2>é…é€Ÿæ’è¡Œæ¦œ</h2>
            <div id="paceContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="night-tab">
            <h2>å¤œè·‘æ’è¡Œæ¦œ <span class="night-runner-title">å¤œè·‘ä¾ è¯„é€‰</span></h2>
            <div id="nightContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="soul-tab">
            <h2>å¿ƒçµè·‘è€… <span class="soul-runner-title">æ„Ÿæ‚Ÿä¹‹æ˜Ÿè¯„é€‰</span></h2>
            <div id="soulContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="consistency-tab">
            <h2>åšæŒå¤©æ•°æ’è¡Œæ¦œ</h2>
            <div id="consistencyContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="runners-tab">
            <h2>æ‰€æœ‰å‚ä¸äººå‘˜ <span style="font-size: 1rem; color: var(--gray);">(æŒ‰æ€»é‡Œç¨‹æ’åº)</span></h2>
            <div id="runnersContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="rewards-tab">
            <h2>ğŸ† æ¿€åŠ±æªæ–½ä¸å¥–åŠ±ä½“ç³»</h2>
            
            <div class="rewards-section">
                <h3>ğŸ èµåŠ©è€…ä¸“å±æƒç›Š</h3>
                <p>æ„Ÿè°¢æ‚¨å¯¹å›¢é˜Ÿå‘å±•çš„æ”¯æŒï¼ŒèµåŠ©è€…å°†è·å¾—ä»¥ä¸‹ä¸“å±æƒç›Šï¼š</p>
                
                <div class="rewards-grid">
                    <div class="reward-card">
                        <div class="reward-header">
                            <div class="reward-title">çƒ­å¿ƒèµåŠ©è€…</div>
                            <div class="reward-level level-basic">20-49å…ƒ</div>
                        </div>
                        <div class="reward-description">æ„Ÿè°¢æ‚¨å¯¹å›¢é˜Ÿçš„æ”¯æŒï¼</div>
                        <ul class="reward-benefits">
                            <li>ä¸“å±èµåŠ©è€…å¾½ç« æ ‡è¯†</li>
                            <li>æœˆåº¦æ„Ÿè°¢ä¿¡</li>
                            <li>å›¢é˜Ÿæ´»åŠ¨ä¼˜å…ˆæŠ¥åæƒ</li>
                            <li>èµåŠ©è€…ä¸“å±è·‘æ­¥è´´çº¸</li>
                        </ul>
                    </div>
                    
                    <div class="reward-card">
                        <div class="reward-header">
                            <div class="reward-title">é“¶ç‰ŒèµåŠ©è€…</div>
                            <div class="reward-level level-basic">50-99å…ƒ</div>
                        </div>
                        <div class="reward-description">æ‚¨çš„æ”¯æŒè®©å›¢é˜Ÿæ›´ç²¾å½©ï¼</div>
                        <ul class="reward-benefits">
                            <li>é“¶ç‰ŒèµåŠ©è€…ä¸“å±å¾½ç« </li>
                            <li>å®šåˆ¶è¿åŠ¨å¤´å·¾</li>
                            <li>å­£åº¦èµåŠ©è€…ç­”è°¢ä¼šé‚€è¯·</li>
                            <li>å›¢é˜Ÿçºªå¿µç…§ç‰‡é›†</li>
                            <li>æ´»åŠ¨è´¹ç”¨8æŠ˜ä¼˜æƒ </li>
                        </ul>
                    </div>
                    
                    <div class="reward-card premium">
                        <div class="reward-header">
                            <div class="reward-title">é‡‘ç‰ŒèµåŠ©è€…</div>
                            <div class="reward-level level-premium">100å…ƒä»¥ä¸Š</div>
                        </div>
                        <div class="reward-description">å›¢é˜Ÿå‘å±•çš„åšå®åç›¾ï¼</div>
                        <ul class="reward-benefits">
                            <li>é‡‘ç‰ŒèµåŠ©è€…é—ªè€€å¾½ç« </li>
                            <li>å®šåˆ¶é˜Ÿæœä¸€å¥—</li>
                            <li>å¹´åº¦ä¼˜ç§€è·‘è€…è¯„é€‰æŠ•ç¥¨æƒ</li>
                            <li>ä¸“å±èµåŠ©è€…è£èª‰å¢™å±•ç¤º</li>
                            <li>æ´»åŠ¨è´¹ç”¨5æŠ˜ä¼˜æƒ </li>
                            <li>å›¢é˜Ÿå†³ç­–å»ºè®®æƒ</li>
                        </ul>
                    </div>
                </div>
                
                <!-- å¯ç¼–è¾‘çš„èµåŠ©è€…æƒç›Šè¯´æ˜ -->
                <div class="editable-section">
                    <h4>èµåŠ©è€…æƒç›Šè¯´æ˜ï¼ˆå¯ç¼–è¾‘ï¼‰</h4>
                    <div id="sponsorRightsContent">
                        <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="editable-controls">
                        <button class="edit-btn" id="editSponsorRights">ç¼–è¾‘</button>
                    </div>
                </div>
            </div>

            <div class="points-system">
                <h3>â­ è·‘æ­¥ç§¯åˆ†å…‘æ¢ä½“ç³»</h3>
                <p>æ¯è·‘æ­¥1å…¬é‡Œè·å¾—1ç§¯åˆ†ï¼Œç§¯åˆ†å¯å…‘æ¢ä¸°å¯Œå¥–åŠ±ï¼š</p>
                
                <table class="points-table">
                    <thead>
                        <tr>
                            <th>ç§¯åˆ†åŒºé—´</th>
                            <th>å¯å…‘æ¢å¥–åŠ±</th>
                            <th>å¤‡æ³¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>100-299åˆ†</td>
                            <td>è¿åŠ¨è¢œã€å¤´å·¾ã€æ°´å£¶</td>
                            <td>åŸºç¡€è£…å¤‡</td>
                        </tr>
                        <tr>
                            <td>300-499åˆ†</td>
                            <td>è·‘æ­¥è…°åŒ…ã€æ‰‹å¥—ã€ç©ºé¡¶å¸½</td>
                            <td>å®ç”¨é…ä»¶</td>
                        </tr>
                        <tr>
                            <td>500-999åˆ†</td>
                            <td>è¿åŠ¨Tæ¤ã€çŸ­è£¤ã€è·‘æ­¥è¢œ</td>
                            <td>ä¸“ä¸šè£…å¤‡</td>
                        </tr>
                        <tr>
                            <td>1000åˆ†ä»¥ä¸Š</td>
                            <td>å®šåˆ¶é˜Ÿæœã€è·‘æ­¥é‹ã€è¿åŠ¨æ‰‹è¡¨</td>
                            <td>é«˜çº§å¥–åŠ±</td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- å¯ç¼–è¾‘çš„ç§¯åˆ†å…‘æ¢è¯´æ˜ -->
                <div class="editable-section">
                    <h4>ç§¯åˆ†å…‘æ¢è¯´æ˜ï¼ˆå¯ç¼–è¾‘ï¼‰</h4>
                    <div id="pointsExchangeContent">
                        <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="editable-controls">
                        <button class="edit-btn" id="editPointsExchange">ç¼–è¾‘</button>
                    </div>
                </div>
            </div>

            <div class="funds-usage">
                <h3>ğŸ’« æœˆåº¦/å­£åº¦ç‰¹åˆ«å¥–åŠ±</h3>
                <div class="usage-plan">
                    <ul>
                        <li>ğŸƒâ€â™‚ï¸ <strong>æœˆåº¦è·‘é‡ç‹</strong> - å½“æœˆè·‘é‡å‰ä¸‰åè·å¾—å®šåˆ¶å¥–ç‰Œ</li>
                        <li>ğŸŒ™ <strong>å¤œè·‘ä¹‹æ˜Ÿ</strong> - æœˆåº¦å¤œè·‘æ¬¡æ•°æœ€å¤šè€…è·å¾—å¤œè·‘è£…å¤‡</li>
                        <li>ğŸ’– <strong>å¿ƒçµè·‘è€…</strong> - ç”¨å¿ƒæ„Ÿå—åˆ†äº«æœ€å¤šè€…è·å¾—ç‰¹åˆ«ç¤¼å“</li>
                        <li>ğŸ“… <strong>å…¨å‹¤å¥–</strong> - å½“æœˆå…¨å‹¤è·‘è€…è·å¾—è¿åŠ¨è¡¥ç»™åŒ…</li>
                        <li>âš¡ <strong>è¿›æ­¥å¥–</strong> - é…é€Ÿæå‡æœ€å¿«è€…è·å¾—ä¸“ä¸šæŒ‡å¯¼</li>
                        <li>ğŸŒŸ <strong>å¹´åº¦å¤§å¥–</strong> - å¹´ç»ˆè¯„é€‰å„é¡¹æœ€ä½³ï¼Œä¸°åšå¥–åŠ±</li>
                    </ul>
                </div>
                
                <!-- å¯ç¼–è¾‘çš„ç‰¹åˆ«å¥–åŠ±è¯´æ˜ -->
                <div class="editable-section">
                    <h4>ç‰¹åˆ«å¥–åŠ±è¯´æ˜ï¼ˆå¯ç¼–è¾‘ï¼‰</h4>
                    <div id="specialRewardsContent">
                        <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="editable-controls">
                        <button class="edit-btn" id="editSpecialRewards">ç¼–è¾‘</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="funds-tab">
            <h2>å›¢é˜Ÿå»ºè®¾èµ„é‡‘ <span class="soul-runner-title">é€æ˜å…¬å¼€</span></h2>
            
            <div class="funds-summary">
                <div class="funds-stats">
                    <div class="funds-card">
                        <div class="stat-value" style="color: var(--secondary);">Â¥<span id="totalFunds">0</span></div>
                        <div class="stat-label">å½“å‰èµ„é‡‘ä½™é¢</div>
                    </div>
                    <div class="funds-card">
                        <div class="stat-value" style="color: var(--primary);"><span id="totalSponsors">0</span>äºº</div>
                        <div class="stat-label">èµåŠ©äººæ•°</div>
                    </div>
                    <div class="funds-card">
                        <div class="stat-value" style="color: var(--accent);"><span id="fundsUsage">0</span>æ¬¡</div>
                        <div class="stat-label">èµ„é‡‘ä½¿ç”¨è®°å½•</div>
                    </div>
                </div>
            </div>

            <div class="funds-actions">
                <h3>æ”¯æŒå›¢é˜Ÿå‘å±•</h3>
                <p style="color: var(--gray); margin-bottom: 15px;">æ‚¨çš„èµåŠ©å°†ç”¨äºå›¢é˜Ÿè£…å¤‡ã€æ´»åŠ¨ç»„ç»‡å’Œè·‘è€…å¥–åŠ±ï¼Œæ‰€æœ‰æ”¶æ”¯å…¬å¼€é€æ˜ã€‚</p>
                <div class="sponsor-options">
                    <button class="btn btn-success sponsor-btn" data-amount="20">èµåŠ©20å…ƒ</button>
                    <button class="btn btn-primary sponsor-btn" data-amount="50">èµåŠ©50å…ƒ</button>
                    <button class="btn btn-info sponsor-btn" data-amount="100">èµåŠ©100å…ƒ</button>
                    <button class="btn btn-warning" id="customAmountBtn">è‡ªå®šä¹‰é‡‘é¢</button>
                </div>
                
                <div id="customAmountInput" style="display: none; margin-top: 15px;">
                    <input type="number" id="customAmount" placeholder="è¾“å…¥èµåŠ©é‡‘é¢" class="form-control" style="width: 200px; display: inline-block;">
                    <button class="btn btn-success" id="submitCustomAmount">ç¡®è®¤èµåŠ©</button>
                </div>
                
                <!-- èµ„é‡‘ä½¿ç”¨è®°å½•è¡¨å• -->
                <div class="usage-record-form">
                    <h4>æ·»åŠ èµ„é‡‘ä½¿ç”¨è®°å½•</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="usageAmount">ä½¿ç”¨é‡‘é¢ (å…ƒ)</label>
                            <input type="number" id="usageAmount" class="form-control" placeholder="ä¾‹å¦‚ï¼š100" min="0">
                        </div>
                        <div class="form-group">
                            <label for="usageDate">ä½¿ç”¨æ—¥æœŸ</label>
                            <input type="date" id="usageDate" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="usageDescription">ç”¨é€”è¯´æ˜</label>
                        <input type="text" id="usageDescription" class="form-control" placeholder="ä¾‹å¦‚ï¼šè´­ä¹°å›¢é˜Ÿè¡¥ç»™å“">
                    </div>
                    <button class="btn btn-primary" id="addUsageRecordBtn">æ·»åŠ ä½¿ç”¨è®°å½•</button>
                </div>
            </div>

            <div class="funds-records">
                <h3>èµ„é‡‘æµæ°´è®°å½•</h3>
                <div id="fundsRecordsContent">
                    <!-- èµ„é‡‘è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="funds-usage">
                <h3>èµ„é‡‘ä½¿ç”¨è®¡åˆ’</h3>
                <div class="usage-plan">
                    <ul>
                        <li>âœ“ å›¢é˜Ÿè·‘æ­¥è£…å¤‡ï¼ˆé˜Ÿæ——ã€å·ç å¸ƒç­‰ï¼‰</li>
                        <li>âœ“ æ´»åŠ¨é¥®ç”¨æ°´å’Œè¡¥ç»™å“</li>
                        <li>âœ“ æ¯”èµ›æŠ¥åè´¹è¡¥è´´</li>
                        <li>âœ“ å¹´åº¦ä¼˜ç§€è·‘è€…å¥–åŠ±</li>
                        <li>âœ“ å›¢é˜Ÿèšä¼šæ´»åŠ¨</li>
                        <li>âœ“ ç³»ç»Ÿç»´æŠ¤å’ŒæŠ€æœ¯æ”¯æŒ</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="records-tab">
            <h2>æ‰“å¡è®°å½•</h2>
            <div id="recordsContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="charts-tab">
            <h2>æ•°æ®ç»Ÿè®¡å›¾è¡¨</h2>
            <div id="chartsContent">
                <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="tab-content" id="data-management-tab">
            <h2>æ•°æ®ç®¡ç†</h2>
            <div class="data-management">
                <h3>æ•°æ®å¯¼å‡º</h3>
                <p>å°†å½“å‰è·‘æ­¥æ•°æ®å¯¼å‡ºä¸ºæ–‡ä»¶ï¼Œç”¨äºå¤‡ä»½æˆ–è¿ç§»æ•°æ®ã€‚</p>
                <div class="import-export-options">
                    <button id="exportJsonBtn" class="btn btn-primary">å¯¼å‡ºä¸ºJSON</button>
                    <button id="exportCsvBtn" class="btn btn-info">å¯¼å‡ºä¸ºCSV</button>
                    <button id="copyDataBtn" class="btn btn-warning">å¤åˆ¶æ•°æ®åˆ°å‰ªè´´æ¿</button>
                </div>
                
                <h3>æ•°æ®å¯¼å…¥</h3>
                <p>ä»æ–‡ä»¶å¯¼å…¥å†å²è·‘æ­¥æ•°æ®ï¼Œæ”¯æŒJSONå’ŒCSVæ ¼å¼ã€‚</p>
                <div class="import-export-options">
                    <label for="importFile" class="file-label">
                        é€‰æ‹©å¯¼å…¥æ–‡ä»¶
                    </label>
                    <input type="file" id="importFile" class="file-input" accept=".json,.csv">
                    <button id="importDataBtn" class="btn btn-success">å¯¼å…¥æ•°æ®</button>
                    <button id="clearDataBtn" class="btn btn-danger">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                </div>
                
                <div class="import-format">
                    <h4>æ•°æ®æ ¼å¼è¯´æ˜</h4>
                    <p>JSONæ ¼å¼ç¤ºä¾‹ï¼š</p>
                    <pre>[
  {
    "runner": "å¼ ä¸‰",
    "date": "2023-10-15",
    "distance": 5.2,
    "time": 28,
    "pace": "5:23",
    "feeling": "ç²¾åŠ›å……æ²›",
    "type": "æ™¨è·‘"
  },
  {
    "runner": "æå››",
    "date": "2023-10-15",
    "distance": 4.8,
    "time": 26,
    "pace": "5:25",
    "feeling": "çŠ¶æ€è‰¯å¥½",
    "type": "å¤œè·‘"
  }
]</pre>
                    
                    <p>CSVæ ¼å¼ç¤ºä¾‹ï¼š</p>
                    <pre>è·‘æ­¥è€…,æ—¥æœŸ,é‡Œç¨‹,æ—¶é•¿,é…é€Ÿ,æ„Ÿå—,æ™¨è·‘/å¤œè·‘
å¼ ä¸‰,2023-10-15,5.2,28,5:23,ç²¾åŠ›å……æ²›,æ™¨è·‘
æå››,2023-10-15,4.8,26,5:25,çŠ¶æ€è‰¯å¥½,å¤œè·‘</pre>
                </div>
            </div>
        </div>
        
        <footer>
            <div class="footer-text">æ± å·æ‚¦è·‘å›¢ Â© 2025</div>
            <div class="footer-slogan">å¥åº·ç”Ÿæ´»ï¼Œä»è·‘æ­¥å¼€å§‹</div>
        </footer>
    </div>

    <div id="message" class="message"></div>

    <script>
        // LeanCloud åˆå§‹åŒ–é…ç½®
        const APP_ID = '{{EbUnWsKPYC9pTbhukuf8aNqe-gzGzoHsz}}';  // è¯·æ›¿æ¢ä¸ºæ‚¨çš„LeanCloud App ID
        const APP_KEY = '{{SrUVb4rXu31JoTtnNZ4X07CP}}'; // è¯·æ›¿æ¢ä¸ºæ‚¨çš„LeanCloud App Key
        const SERVER_URL = '{{poPMpyVKzGdsAQ3FT3XBFABr}}'; // è¯·æ›¿æ¢ä¸ºæ‚¨çš„LeanCloudæœåŠ¡å™¨åœ°å€
        
        // åˆå§‹åŒ–LeanCloud
        AV.init({
            appId: APP_ID,
            appKey: APP_KEY,
            serverURL: SERVER_URL
        });
        
        // æ•°æ®æ¨¡å‹å®šä¹‰
        const RunRecord = AV.Object.extend('RunRecord');
        const FundsData = AV.Object.extend('FundsData');
        const RewardsData = AV.Object.extend('RewardsData');
        
        // å…¨å±€æ•°æ®å­˜å‚¨
        let runningRecords = [];
        let fundsData = {
            totalFunds: 0,
            sponsors: [],
            usageRecords: []
        };
        let pointsData = {};
        let rewardsData = {
            sponsorRights: "æ„Ÿè°¢æ‰€æœ‰èµåŠ©è€…å¯¹æ± å·æ‚¦è·‘å›¢çš„æ”¯æŒï¼æ‚¨çš„èµåŠ©å°†ç”¨äºå›¢é˜Ÿè£…å¤‡é‡‡è´­ã€æ´»åŠ¨ç»„ç»‡ã€è·‘è€…å¥–åŠ±ç­‰æ–¹é¢ã€‚æ‰€æœ‰èµåŠ©è€…éƒ½å°†è·å¾—ç›¸åº”çš„æƒç›Šå’Œè£èª‰ã€‚",
            pointsExchange: "ç§¯åˆ†å…‘æ¢è§„åˆ™ï¼š\n1. æ¯è·‘æ­¥1å…¬é‡Œè·å¾—1ç§¯åˆ†\n2. å¤œè·‘æ¯æ¬¡é¢å¤–å¥–åŠ±5ç§¯åˆ†\n3. ç”¨å¿ƒæ„Ÿå—æ¯æ¬¡é¢å¤–å¥–åŠ±10ç§¯åˆ†\n4. æ¯æœˆå…¨å‹¤é¢å¤–å¥–åŠ±30ç§¯åˆ†\n5. ç§¯åˆ†å¯å…‘æ¢è·‘æ­¥è£…å¤‡ã€é…ä»¶å’Œç‰¹åˆ«å¥–åŠ±",
            specialRewards: "ç‰¹åˆ«å¥–åŠ±è¯´æ˜ï¼š\n1. æœˆåº¦è·‘é‡ç‹ï¼šå½“æœˆè·‘é‡å‰ä¸‰åè·å¾—å®šåˆ¶å¥–ç‰Œ\n2. å¤œè·‘ä¹‹æ˜Ÿï¼šæœˆåº¦å¤œè·‘æ¬¡æ•°æœ€å¤šè€…è·å¾—å¤œè·‘è£…å¤‡\n3. å¿ƒçµè·‘è€…ï¼šç”¨å¿ƒæ„Ÿå—åˆ†äº«æœ€å¤šè€…è·å¾—ç‰¹åˆ«ç¤¼å“\n4. å…¨å‹¤å¥–ï¼šå½“æœˆå…¨å‹¤è·‘è€…è·å¾—è¿åŠ¨è¡¥ç»™åŒ…\n5. è¿›æ­¥å¥–ï¼šé…é€Ÿæå‡æœ€å¿«è€…è·å¾—ä¸“ä¸šæŒ‡å¯¼\n6. å¹´åº¦å¤§å¥–ï¼šå¹´ç»ˆè¯„é€‰å„é¡¹æœ€ä½³ï¼Œä¸°åšå¥–åŠ±"
        };

        // è¾…åŠ©å‡½æ•°ï¼šè·å–æ—¥æœŸå­—ç¬¦ä¸²
        function getDateString(daysOffset = 0) {
            const date = new Date();
            date.setDate(date.getDate() + daysOffset);
            return date.toISOString().split('T')[0];
        }

        // æ˜¾ç¤ºæ¶ˆæ¯å‡½æ•°
        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = `message ${type}`;
            message.classList.add('show');
            
            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function setLoading(loading) {
            const overlay = document.getElementById('loadingOverlay');
            if (loading) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        // è®¡ç®—é…é€Ÿå‡½æ•°
        function calculatePace(distance, time) {
            if (!distance || !time || distance <= 0 || time <= 0) {
                return null;
            }
            
            // è®¡ç®—æ¯å…¬é‡Œéœ€è¦çš„æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
            const pacePerKm = time / distance;
            
            // è½¬æ¢ä¸ºåˆ†é’Ÿå’Œç§’
            const minutes = Math.floor(pacePerKm);
            const seconds = Math.round((pacePerKm - minutes) * 60);
            
            // æ ¼å¼åŒ–è¾“å‡º
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // æ›´æ–°é…é€Ÿæ˜¾ç¤º
        function updatePaceDisplay() {
            const distance = parseFloat(runDistance.value);
            const time = parseFloat(runTime.value);
            
            const pace = calculatePace(distance, time);
            
            if (pace) {
                paceResult.textContent = pace;
                runPace.value = pace;
            } else {
                paceResult.textContent = '--:--';
                runPace.value = '';
            }
        }

        // å¤„ç†æ„Ÿå—é€‰æ‹©å˜åŒ–
        function handleFeelingChange() {
            if (runFeeling.value === 'custom') {
                customFeeling.style.display = 'block';
                customFeeling.focus();
            } else {
                customFeeling.style.display = 'none';
                customFeeling.value = '';
            }
        }

        // è·å–æœ€ç»ˆæ„Ÿå—å€¼
        function getFinalFeeling() {
            if (runFeeling.value === 'custom') {
                return customFeeling.value.trim() || 'æ­£å¸¸';
            }
            return runFeeling.value;
        }

        // æ ¹æ®æ„Ÿå—æ–‡æœ¬è·å–æ ·å¼ç±»
        function getFeelingClass(feeling) {
            if (feeling === 'ç²¾åŠ›å……æ²›') return 'feeling-excellent';
            if (feeling === 'çŠ¶æ€è‰¯å¥½') return 'feeling-good';
            if (feeling === 'æ­£å¸¸') return 'feeling-normal';
            if (feeling === 'æœ‰ç‚¹ç–²æƒ«') return 'feeling-tired';
            return 'feeling-custom-style'; // è‡ªå®šä¹‰æ„Ÿå—ä½¿ç”¨ç‰¹æ®Šæ ·å¼
        }

        // åˆ¤æ–­æ˜¯å¦ä¸ºç”¨å¿ƒæ„Ÿå—ï¼ˆéæ ‡å‡†é€‰é¡¹ä¸”é•¿åº¦è¾ƒé•¿ï¼‰
        function isHeartfeltFeeling(feeling) {
            const standardFeelings = ['ç²¾åŠ›å……æ²›', 'çŠ¶æ€è‰¯å¥½', 'æ­£å¸¸', 'æœ‰ç‚¹ç–²æƒ«'];
            return !standardFeelings.includes(feeling) && feeling.length > 6;
        }

        // ä»LeanCloudåŠ è½½è·‘æ­¥è®°å½•
        async function loadRunningRecords() {
            setLoading(true);
            try {
                const query = new AV.Query('RunRecord');
                query.addDescending('createdAt');
                const results = await query.find();
                
                runningRecords = results.map(record => ({
                    id: record.id,
                    runner: record.get('runner'),
                    date: record.get('date'),
                    distance: record.get('distance'),
                    time: record.get('time'),
                    pace: record.get('pace'),
                    feeling: record.get('feeling'),
                    type: record.get('type')
                }));
                
                console.log('è·‘æ­¥è®°å½•åŠ è½½æˆåŠŸ:', runningRecords.length, 'æ¡è®°å½•');
                return true;
            } catch (error) {
                console.error('åŠ è½½è·‘æ­¥è®°å½•å¤±è´¥:', error);
                showMessage('åŠ è½½è·‘æ­¥è®°å½•å¤±è´¥: ' + error.message, 'error');
                return false;
            } finally {
                setLoading(false);
            }
        }

        // ä¿å­˜è·‘æ­¥è®°å½•åˆ°LeanCloud
        async function saveRunningRecord(record) {
            try {
                const RunRecord = AV.Object.extend('RunRecord');
                const newRecord = new RunRecord();
                
                newRecord.set('runner', record.runner);
                newRecord.set('date', record.date);
                newRecord.set('distance', record.distance);
                newRecord.set('time', record.time);
                newRecord.set('pace', record.pace);
                newRecord.set('feeling', record.feeling);
                newRecord.set('type', record.type);
                
                await newRecord.save();
                record.id = newRecord.id; // ä¿å­˜å¯¹è±¡ID
                
                console.log('è·‘æ­¥è®°å½•ä¿å­˜æˆåŠŸ:', record);
                return true;
            } catch (error) {
                console.error('ä¿å­˜è·‘æ­¥è®°å½•å¤±è´¥:', error);
                showMessage('ä¿å­˜è·‘æ­¥è®°å½•å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        // ä»LeanCloudåŠ è½½èµ„é‡‘æ•°æ®
        async function loadFundsData() {
            try {
                const query = new AV.Query('FundsData');
                query.equalTo('type', 'main');
                const result = await query.first();
                
                if (result) {
                    fundsData = {
                        totalFunds: result.get('totalFunds') || 0,
                        sponsors: result.get('sponsors') || [],
                        usageRecords: result.get('usageRecords') || []
                    };
                }
                
                console.log('èµ„é‡‘æ•°æ®åŠ è½½æˆåŠŸ');
                return true;
            } catch (error) {
                console.error('åŠ è½½èµ„é‡‘æ•°æ®å¤±è´¥:', error);
                return false;
            }
        }

        // ä¿å­˜èµ„é‡‘æ•°æ®åˆ°LeanCloud
        async function saveFundsData() {
            try {
                const query = new AV.Query('FundsData');
                query.equalTo('type', 'main');
                let fundsRecord = await query.first();
                
                if (!fundsRecord) {
                    fundsRecord = new FundsData();
                    fundsRecord.set('type', 'main');
                }
                
                fundsRecord.set('totalFunds', fundsData.totalFunds);
                fundsRecord.set('sponsors', fundsData.sponsors);
                fundsRecord.set('usageRecords', fundsData.usageRecords);
                
                await fundsRecord.save();
                console.log('èµ„é‡‘æ•°æ®ä¿å­˜æˆåŠŸ');
                return true;
            } catch (error) {
                console.error('ä¿å­˜èµ„é‡‘æ•°æ®å¤±è´¥:', error);
                showMessage('ä¿å­˜èµ„é‡‘æ•°æ®å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        // ä»LeanCloudåŠ è½½æ¿€åŠ±æªæ–½æ•°æ®
        async function loadRewardsData() {
            try {
                const query = new AV.Query('RewardsData');
                query.equalTo('type', 'main');
                const result = await query.first();
                
                if (result) {
                    rewardsData = {
                        sponsorRights: result.get('sponsorRights') || rewardsData.sponsorRights,
                        pointsExchange: result.get('pointsExchange') || rewardsData.pointsExchange,
                        specialRewards: result.get('specialRewards') || rewardsData.specialRewards
                    };
                }
                
                console.log('æ¿€åŠ±æªæ–½æ•°æ®åŠ è½½æˆåŠŸ');
                return true;
            } catch (error) {
                console.error('åŠ è½½æ¿€åŠ±æªæ–½æ•°æ®å¤±è´¥:', error);
                return false;
            }
        }

        // ä¿å­˜æ¿€åŠ±æªæ–½æ•°æ®åˆ°LeanCloud
        async function saveRewardsData() {
            try {
                const query = new AV.Query('RewardsData');
                query.equalTo('type', 'main');
                let rewardsRecord = await query.first();
                
                if (!rewardsRecord) {
                    rewardsRecord = new RewardsData();
                    rewardsRecord.set('type', 'main');
                }
                
                rewardsRecord.set('sponsorRights', rewardsData.sponsorRights);
                rewardsRecord.set('pointsExchange', rewardsData.pointsExchange);
                rewardsRecord.set('specialRewards', rewardsData.specialRewards);
                
                await rewardsRecord.save();
                console.log('æ¿€åŠ±æªæ–½æ•°æ®ä¿å­˜æˆåŠŸ');
                return true;
            } catch (error) {
                console.error('ä¿å­˜æ¿€åŠ±æªæ–½æ•°æ®å¤±è´¥:', error);
                showMessage('ä¿å­˜æ¿€åŠ±æªæ–½æ•°æ®å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        // è®¡ç®—è·‘æ­¥è€…ç§¯åˆ†
        function calculateRunnerPoints(runner) {
            const runnerRecords = runningRecords.filter(record => record.runner === runner);
            const totalDistance = runnerRecords.reduce((sum, record) => sum + record.distance, 0);
            
            // åŸºç¡€ç§¯åˆ†ï¼š1å…¬é‡Œ=1ç§¯åˆ†
            let points = Math.floor(totalDistance);
            
            // é¢å¤–å¥–åŠ±ç§¯åˆ†
            const nightRuns = runnerRecords.filter(record => record.type === 'å¤œè·‘').length;
            const soulRuns = runnerRecords.filter(record => isHeartfeltFeeling(record.feeling)).length;
            const runDays = new Set(runnerRecords.map(record => record.date)).size;
            
            points += nightRuns * 5; // å¤œè·‘æ¯æ¬¡é¢å¤–5åˆ†
            points += soulRuns * 10; // ç”¨å¿ƒæ„Ÿå—æ¯æ¬¡é¢å¤–10åˆ†
            points += runDays * 3;   // è·‘æ­¥å¤©æ•°æ¯å¤©é¢å¤–3åˆ†
            
            return points;
        }

        // æ›´æ–°æ‰€æœ‰è·‘æ­¥è€…ç§¯åˆ†
        function updateAllPoints() {
            const runners = [...new Set(runningRecords.map(record => record.runner))];
            runners.forEach(runner => {
                pointsData[runner] = calculateRunnerPoints(runner);
            });
        }

        // è®¾ç½®å‚ä¸äººæ•°å¡ç‰‡ç‚¹å‡»äº‹ä»¶
        function setupRunnersCardClick() {
            const runnersCard = document.getElementById('runnersCard');
            if (runnersCard) {
                runnersCard.addEventListener('click', function() {
                    // åˆ‡æ¢åˆ°å‚ä¸äººå‘˜æ ‡ç­¾é¡µ
                    const tabs = document.querySelectorAll('.tab');
                    const tabContents = document.querySelectorAll('.tab-content');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // æ‰¾åˆ°å‚ä¸äººå‘˜æ ‡ç­¾å¹¶æ¿€æ´»
                    const runnersTab = document.querySelector('.tab[data-tab="runners"]');
                    if (runnersTab) {
                        runnersTab.classList.add('active');
                        document.getElementById('runners-tab').classList.add('active');
                        updateRunnersList();
                    }
                });
            }
        }

        // æ›´æ–°å‚ä¸äººå‘˜åˆ—è¡¨å‡½æ•°
        function updateRunnersList() {
            const content = document.getElementById('runnersContent');
            
            // è·å–æ‰€æœ‰è·‘æ­¥è€…
            const runners = [...new Set(runningRecords.map(record => record.runner))];
            
            if (runners.length === 0) {
                content.innerHTML = '<div class="no-data">æš‚æ— å‚ä¸äººå‘˜æ•°æ®</div>';
                return;
            }
            
            // æ›´æ–°ç§¯åˆ†æ•°æ®
            updateAllPoints();
            
            // è®¡ç®—æ¯ä¸ªè·‘æ­¥è€…çš„è¯¦ç»†ç»Ÿè®¡
            const runnerStats = runners.map(runner => {
                const runnerRecords = runningRecords.filter(record => record.runner === runner);
                const totalDistance = runnerRecords.reduce((sum, record) => sum + record.distance, 0);
                const totalTime = runnerRecords.reduce((sum, record) => sum + record.time, 0);
                const runDays = new Set(runnerRecords.map(record => record.date)).size;
                
                // è®¡ç®—å¹³å‡é…é€Ÿ
                let totalPaceSeconds = 0;
                runnerRecords.forEach(record => {
                    const [minutes, seconds] = record.pace.split(':').map(Number);
                    totalPaceSeconds += (minutes * 60 + seconds) * record.distance;
                });
                
                let avgPace = '0:00';
                if (totalDistance > 0) {
                    const avgPaceSeconds = totalPaceSeconds / totalDistance;
                    const avgMinutes = Math.floor(avgPaceSeconds / 60);
                    const avgSeconds = Math.round(avgPaceSeconds % 60);
                    avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
                }
                
                // è®¡ç®—æœ€åè·‘æ­¥æ—¥æœŸ
                const lastRun = runnerRecords.reduce((latest, record) => 
                    record.date > latest ? record.date : latest, '');
                
                // ç»Ÿè®¡å¤œè·‘æ¬¡æ•°å’Œç”¨å¿ƒæ„Ÿå—æ¬¡æ•°
                const nightRuns = runnerRecords.filter(record => record.type === 'å¤œè·‘').length;
                const soulRuns = runnerRecords.filter(record => 
                    isHeartfeltFeeling(record.feeling)
                ).length;

                // è®¡ç®—èµåŠ©é‡‘é¢
                const sponsorAmount = fundsData.sponsors
                    .filter(s => s.name === runner)
                    .reduce((sum, s) => sum + s.amount, 0);

                // è·å–ç§¯åˆ†
                const points = pointsData[runner] || 0;
                
                return {
                    name: runner,
                    totalRuns: runnerRecords.length,
                    totalDistance: totalDistance,
                    totalTime: totalTime,
                    runDays: runDays,
                    avgPace: avgPace,
                    lastRun: lastRun,
                    nightRuns: nightRuns,
                    soulRuns: soulRuns,
                    sponsorAmount: sponsorAmount,
                    points: points
                };
            });
            
            // æŒ‰æ€»é‡Œç¨‹æ’åº
            runnerStats.sort((a, b) => b.totalDistance - a.totalDistance);
            
            let html = `
                <div class="runners-summary" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h3>ç»Ÿè®¡æ¦‚è§ˆ</h3>
                    <p>å…±æœ‰ <strong>${runners.length}</strong> ä½è·‘è€…å‚ä¸äº†è·‘æ­¥æ´»åŠ¨ï¼Œç´¯è®¡è·‘æ­¥ <strong>${runningRecords.length}</strong> æ¬¡ï¼Œæ€»é‡Œç¨‹ <strong>${runnerStats.reduce((sum, runner) => sum + runner.totalDistance, 0).toFixed(1)}</strong> å…¬é‡Œã€‚</p>
                </div>
                
                <div class="runners-grid">
            `;
            
            runnerStats.forEach((runner, index) => {
                const isTop = index < 3;
                const badges = [];
                
                if (runner.nightRuns > 0) {
                    badges.push(`<span class="badge badge-night">å¤œè·‘${runner.nightRuns}æ¬¡</span>`);
                }
                
                if (runner.soulRuns > 0) {
                    badges.push(`<span class="badge badge-soul">ç”¨å¿ƒ${runner.soulRuns}æ¬¡</span>`);
                }
                
                if (runner.runDays >= 10) {
                    badges.push(`<span class="badge badge-consistent">åšæŒ${runner.runDays}å¤©</span>`);
                }
                
                // åˆ¤æ–­æ˜¯å¦ä¸ºå¿«é€Ÿè·‘è€…ï¼ˆå¹³å‡é…é€Ÿå°äº5:30ï¼‰
                const [minutes, seconds] = runner.avgPace.split(':').map(Number);
                const paceSeconds = minutes * 60 + seconds;
                if (paceSeconds < 330) { // 5åˆ†30ç§’ = 330ç§’
                    badges.push(`<span class="badge badge-fast">é…é€Ÿè¾¾äºº</span>`);
                }

                // æ·»åŠ èµåŠ©è€…å¾½ç« 
                if (runner.sponsorAmount > 0) {
                    if (runner.sponsorAmount >= 100) {
                        badges.push(`<span class="badge badge-sponsor-gold">é‡‘ç‰ŒèµåŠ©</span>`);
                    } else if (runner.sponsorAmount >= 50) {
                        badges.push(`<span class="badge badge-sponsor-silver">é“¶ç‰ŒèµåŠ©</span>`);
                    } else {
                        badges.push(`<span class="badge badge-sponsor-bronze">çƒ­å¿ƒèµåŠ©</span>`);
                    }
                }

                // æ·»åŠ ç§¯åˆ†å¾½ç« 
                if (runner.points >= 1000) {
                    badges.push(`<span class="badge" style="background: var(--gold); color: black;">ç§¯åˆ†è¾¾äºº</span>`);
                } else if (runner.points >= 500) {
                    badges.push(`<span class="badge" style="background: var(--silver); color: black;">æ´»è·ƒè·‘è€…</span>`);
                } else if (runner.points >= 100) {
                    badges.push(`<span class="badge" style="background: var(--bronze); color: white;">è·‘æ­¥æ–°æ˜Ÿ</span>`);
                }
                
                html += `
                    <div class="runner-card ${isTop ? 'top-runner' : ''}">
                        <div class="runner-header">
                            <div class="runner-name">${runner.name}</div>
                            <div class="runner-rank">${index + 1}</div>
                        </div>
                        
                        <div class="runner-stats">
                            <div class="stat-item">
                                <div class="stat-number">${runner.totalRuns}</div>
                                <div class="stat-label">è·‘æ­¥æ¬¡æ•°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">${runner.totalDistance.toFixed(1)}</div>
                                <div class="stat-label">æ€»é‡Œç¨‹(km)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">${runner.runDays}</div>
                                <div class="stat-label">è·‘æ­¥å¤©æ•°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">${runner.points}</div>
                                <div class="stat-label">ç§¯åˆ†</div>
                            </div>
                        </div>
                        
                        <div class="runner-details">
                            <div class="detail-item">
                                <span class="detail-label">å¹³å‡é…é€Ÿ:</span>
                                <span class="detail-value">${runner.avgPace}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">å¤œè·‘æ¬¡æ•°:</span>
                                <span class="detail-value">${runner.nightRuns}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ç”¨å¿ƒæ„Ÿå—:</span>
                                <span class="detail-value">${runner.soulRuns}</span>
                            </div>
                            ${runner.sponsorAmount > 0 ? `
                            <div class="detail-item">
                                <span class="detail-label">å›¢é˜ŸèµåŠ©:</span>
                                <span class="detail-value" style="color: var(--secondary);">${runner.sponsorAmount}å…ƒ</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        ${badges.length > 0 ? `
                            <div class="runner-badges">
                                ${badges.join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        // èµ„é‡‘ç®¡ç†åŠŸèƒ½
        function setupFundsManagement() {
            const sponsorBtns = document.querySelectorAll('.sponsor-btn');
            const customAmountBtn = document.getElementById('customAmountBtn');
            const customAmountInput = document.getElementById('customAmountInput');
            const submitCustomAmount = document.getElementById('submitCustomAmount');
            const customAmount = document.getElementById('customAmount');
            const addUsageRecordBtn = document.getElementById('addUsageRecordBtn');
            const usageAmount = document.getElementById('usageAmount');
            const usageDate = document.getElementById('usageDate');
            const usageDescription = document.getElementById('usageDescription');

            // å›ºå®šé‡‘é¢èµåŠ©
            sponsorBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const amount = parseInt(this.dataset.amount);
                    sponsorTeam(amount);
                });
            });

            // è‡ªå®šä¹‰é‡‘é¢
            customAmountBtn.addEventListener('click', function() {
                customAmountInput.style.display = 'block';
            });

            submitCustomAmount.addEventListener('click', function() {
                const amount = parseInt(customAmount.value);
                if (amount && amount > 0) {
                    sponsorTeam(amount);
                    customAmountInput.style.display = 'none';
                    customAmount.value = '';
                } else {
                    showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„èµåŠ©é‡‘é¢', 'error');
                }
            });

            // æ·»åŠ èµ„é‡‘ä½¿ç”¨è®°å½•
            addUsageRecordBtn.addEventListener('click', async function() {
                const amount = parseFloat(usageAmount.value);
                const date = usageDate.value;
                const description = usageDescription.value.trim();
                
                if (!amount || amount <= 0) {
                    showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„ä½¿ç”¨é‡‘é¢', 'error');
                    return;
                }
                
                if (!date) {
                    showMessage('è¯·é€‰æ‹©ä½¿ç”¨æ—¥æœŸ', 'error');
                    return;
                }
                
                if (!description) {
                    showMessage('è¯·è¾“å…¥ç”¨é€”è¯´æ˜', 'error');
                    return;
                }
                
                if (amount > fundsData.totalFunds) {
                    showMessage('ä½¿ç”¨é‡‘é¢ä¸èƒ½è¶…è¿‡å½“å‰èµ„é‡‘ä½™é¢', 'error');
                    return;
                }
                
                // åˆ›å»ºä½¿ç”¨è®°å½•
                const usageRecord = {
                    amount: amount,
                    date: date,
                    description: description,
                    timestamp: new Date().getTime()
                };
                
                // æ›´æ–°èµ„é‡‘æ•°æ®
                fundsData.totalFunds -= amount;
                fundsData.usageRecords.push(usageRecord);
                
                // ä¿å­˜å¹¶æ›´æ–°æ˜¾ç¤º
                const success = await saveFundsData();
                if (success) {
                    updateFundsDisplay();
                    
                    // é‡ç½®è¡¨å•
                    usageAmount.value = '';
                    usageDate.value = getDateString();
                    usageDescription.value = '';
                    
                    showMessage(`æˆåŠŸæ·»åŠ èµ„é‡‘ä½¿ç”¨è®°å½•ï¼š${description} - ${amount}å…ƒ`, 'success');
                }
            });

            // è®¾ç½®é»˜è®¤ä½¿ç”¨æ—¥æœŸä¸ºä»Šå¤©
            usageDate.value = getDateString();
            
            updateFundsDisplay();
        }

        // èµåŠ©å›¢é˜Ÿå‡½æ•°
        async function sponsorTeam(amount) {
            const runnerName = prompt('è¯·è¾“å…¥æ‚¨çš„å§“åï¼ˆåŒ¿åèµåŠ©è¯·ç•™ç©ºï¼‰:') || 'åŒ¿åè·‘å‹';
            
            const sponsorRecord = {
                name: runnerName,
                amount: amount,
                date: new Date().toISOString().split('T')[0],
                timestamp: new Date().getTime()
            };

            fundsData.totalFunds += amount;
            fundsData.sponsors.push(sponsorRecord);
            
            const success = await saveFundsData();
            if (success) {
                updateFundsDisplay();
                updateRunnersList(); // æ›´æ–°å‚ä¸äººå‘˜åˆ—è¡¨ï¼Œæ˜¾ç¤ºèµåŠ©å¾½ç« 
                
                showMessage(`æ„Ÿè°¢ ${runnerName} èµåŠ© ${amount} å…ƒï¼`, 'success');
            }
        }

        // æ›´æ–°èµ„é‡‘æ˜¾ç¤º
        function updateFundsDisplay() {
            document.getElementById('totalFunds').textContent = fundsData.totalFunds;
            document.getElementById('totalSponsors').textContent = fundsData.sponsors.length;
            document.getElementById('fundsUsage').textContent = fundsData.usageRecords.length;
            
            updateFundsRecords();
        }

        // æ›´æ–°èµ„é‡‘è®°å½•
        function updateFundsRecords() {
            const content = document.getElementById('fundsRecordsContent');
            
            if (fundsData.sponsors.length === 0 && fundsData.usageRecords.length === 0) {
                content.innerHTML = '<div class="no-data">æš‚æ— èµ„é‡‘æµæ°´è®°å½•</div>';
                return;
            }
            
            let html = '';
            
            // åˆå¹¶èµåŠ©å’Œä½¿ç”¨è®°å½•ï¼ŒæŒ‰æ—¶é—´å€’åºæ’åˆ—
            const allRecords = [
                ...fundsData.sponsors.map(r => ({...r, type: 'sponsor'})),
                ...fundsData.usageRecords.map(r => ({...r, type: 'usage'}))
            ].sort((a, b) => b.timestamp - a.timestamp);
            
            allRecords.forEach(record => {
                if (record.type === 'sponsor') {
                    html += `
                        <div class="sponsor-record">
                            <div class="sponsor-info">
                                <div class="sponsor-name">${record.name}</div>
                                <div class="sponsor-amount">+${record.amount}å…ƒ</div>
                            </div>
                            <div class="sponsor-date">${record.date}</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="usage-record">
                            <div class="usage-info">
                                <div class="usage-description">${record.description}</div>
                                <div class="usage-amount">-${record.amount}å…ƒ</div>
                            </div>
                            <div class="usage-date">${record.date}</div>
                        </div>
                    `;
                }
            });
            
            content.innerHTML = html;
        }

        // è®¾ç½®æ¿€åŠ±æªæ–½ç¼–è¾‘åŠŸèƒ½
        function setupRewardsEditing() {
            const editSponsorRights = document.getElementById('editSponsorRights');
            const editPointsExchange = document.getElementById('editPointsExchange');
            const editSpecialRewards = document.getElementById('editSpecialRewards');
            
            // åˆå§‹åŒ–æ˜¾ç¤ºå†…å®¹
            updateRewardsDisplay();
            
            // èµåŠ©è€…æƒç›Šç¼–è¾‘
            editSponsorRights.addEventListener('click', function() {
                const contentDiv = document.getElementById('sponsorRightsContent');
                const currentText = contentDiv.textContent;
                
                contentDiv.innerHTML = `<textarea class="editable-textarea">${currentText}</textarea>`;
                
                // æ·»åŠ ä¿å­˜å’Œå–æ¶ˆæŒ‰é’®
                const controls = this.parentElement;
                controls.innerHTML = `
                    <button class="save-btn" id="saveSponsorRights">ä¿å­˜</button>
                    <button class="cancel-btn" id="cancelSponsorRights">å–æ¶ˆ</button>
                `;
                
                // ä¿å­˜æŒ‰é’®äº‹ä»¶
                document.getElementById('saveSponsorRights').addEventListener('click', async function() {
                    const newText = contentDiv.querySelector('textarea').value;
                    rewardsData.sponsorRights = newText;
                    const success = await saveRewardsData();
                    if (success) {
                        updateRewardsDisplay();
                        showMessage('èµåŠ©è€…æƒç›Šè¯´æ˜å·²æ›´æ–°', 'success');
                    }
                });
                
                // å–æ¶ˆæŒ‰é’®äº‹ä»¶
                document.getElementById('cancelSponsorRights').addEventListener('click', function() {
                    updateRewardsDisplay();
                });
            });
            
            // ç§¯åˆ†å…‘æ¢è¯´æ˜ç¼–è¾‘
            editPointsExchange.addEventListener('click', function() {
                const contentDiv = document.getElementById('pointsExchangeContent');
                const currentText = contentDiv.textContent;
                
                contentDiv.innerHTML = `<textarea class="editable-textarea">${currentText}</textarea>`;
                
                // æ·»åŠ ä¿å­˜å’Œå–æ¶ˆæŒ‰é’®
                const controls = this.parentElement;
                controls.innerHTML = `
                    <button class="save-btn" id="savePointsExchange">ä¿å­˜</button>
                    <button class="cancel-btn" id="cancelPointsExchange">å–æ¶ˆ</button>
                `;
                
                // ä¿å­˜æŒ‰é’®äº‹ä»¶
                document.getElementById('savePointsExchange').addEventListener('click', async function() {
                    const newText = contentDiv.querySelector('textarea').value;
                    rewardsData.pointsExchange = newText;
                    const success = await saveRewardsData();
                    if (success) {
                        updateRewardsDisplay();
                        showMessage('ç§¯åˆ†å…‘æ¢è¯´æ˜å·²æ›´æ–°', 'success');
                    }
                });
                
                // å–æ¶ˆæŒ‰é’®äº‹ä»¶
                document.getElementById('cancelPointsExchange').addEventListener('click', function() {
                    updateRewardsDisplay();
                });
            });
            
            // ç‰¹åˆ«å¥–åŠ±è¯´æ˜ç¼–è¾‘
            editSpecialRewards.addEventListener('click', function() {
                const contentDiv = document.getElementById('specialRewardsContent');
                const currentText = contentDiv.textContent;
                
                contentDiv.innerHTML = `<textarea class="editable-textarea">${currentText}</textarea>`;
                
                // æ·»åŠ ä¿å­˜å’Œå–æ¶ˆæŒ‰é’®
                const controls = this.parentElement;
                controls.innerHTML = `
                    <button class="save-btn" id="saveSpecialRewards">ä¿å­˜</button>
                    <button class="cancel-btn" id="cancelSpecialRewards">å–æ¶ˆ</button>
                `;
                
                // ä¿å­˜æŒ‰é’®äº‹ä»¶
                document.getElementById('saveSpecialRewards').addEventListener('click', async function() {
                    const newText = contentDiv.querySelector('textarea').value;
                    rewardsData.specialRewards = newText;
                    const success = await saveRewardsData();
                    if (success) {
                        updateRewardsDisplay();
                        showMessage('ç‰¹åˆ«å¥–åŠ±è¯´æ˜å·²æ›´æ–°', 'success');
                    }
                });
                
                // å–æ¶ˆæŒ‰é’®äº‹ä»¶
                document.getElementById('cancelSpecialRewards').addEventListener('click', function() {
                    updateRewardsDisplay();
                });
            });
        }
        
        // æ›´æ–°æ¿€åŠ±æªæ–½æ˜¾ç¤º
        function updateRewardsDisplay() {
            document.getElementById('sponsorRightsContent').textContent = rewardsData.sponsorRights;
            document.getElementById('pointsExchangeContent').textContent = rewardsData.pointsExchange;
            document.getElementById('specialRewardsContent').textContent = rewardsData.specialRewards;
            
            // é‡ç½®ç¼–è¾‘æŒ‰é’® - ä¿®å¤å¾ªç¯è°ƒç”¨é—®é¢˜
            const editableControls = document.querySelectorAll('.editable-controls');
            editableControls.forEach(controls => {
                // åªé‡ç½®æŒ‰é’®ï¼Œä¸é‡æ–°ç»‘å®šäº‹ä»¶
                if (!controls.querySelector('.edit-btn')) {
                    controls.innerHTML = '<button class="edit-btn">ç¼–è¾‘</button>';
                }
            });
        }

        // åˆå§‹åŒ–é¡µé¢
        async function initPage() {
            console.log('åˆå§‹åŒ–é¡µé¢...');
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            document.getElementById('runDate').value = getDateString();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            runDistance.addEventListener('input', updatePaceDisplay);
            runTime.addEventListener('input', updatePaceDisplay);
            runFeeling.addEventListener('change', handleFeelingChange);
            
            // åŠ è½½æ•°æ®
            await loadRunningRecords();
            await loadFundsData();
            await loadRewardsData();
            
            // æ·»åŠ æ‰“å¡è®°å½•
            addRecordBtn.addEventListener('click', async function() {
                const runnerName = document.getElementById('runnerName').value.trim();
                const runDate = document.getElementById('runDate').value;
                const distance = parseFloat(runDistance.value);
                const time = parseFloat(runTime.value);
                const feeling = getFinalFeeling();
                const type = document.getElementById('runType').value;
                const pace = runPace.value;
                
                // éªŒè¯è¾“å…¥
                if (!runnerName) {
                    showMessage('è¯·è¾“å…¥è·‘æ­¥è€…å§“å', 'error');
                    return;
                }
                
                if (!runDate) {
                    showMessage('è¯·é€‰æ‹©è·‘æ­¥æ—¥æœŸ', 'error');
                    return;
                }
                
                if (!distance || distance <= 0) {
                    showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„è·‘æ­¥é‡Œç¨‹', 'error');
                    return;
                }
                
                if (!time || time <= 0) {
                    showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„è·‘æ­¥æ—¶é•¿', 'error');
                    return;
                }
                
                if (!pace) {
                    showMessage('è¯·ç¡®ä¿é‡Œç¨‹å’Œæ—¶é•¿è¾“å…¥æ­£ç¡®ä»¥è®¡ç®—é…é€Ÿ', 'error');
                    return;
                }
                
                // åˆ›å»ºæ–°è®°å½•
                const newRecord = {
                    runner: runnerName,
                    date: runDate,
                    distance: distance,
                    time: time,
                    pace: pace,
                    feeling: feeling,
                    type: type
                };
                
                // ä¿å­˜åˆ°LeanCloud
                const success = await saveRunningRecord(newRecord);
                if (success) {
                    // æ·»åŠ åˆ°æœ¬åœ°è®°å½•æ•°ç»„
                    runningRecords.push(newRecord);
                    
                    // æ›´æ–°ç•Œé¢
                    updateDashboard();
                    updateAllTabs();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showMessage('æ‰“å¡æˆåŠŸï¼', 'success');
                    
                    // é‡ç½®è¡¨å•
                    document.getElementById('runnerName').value = '';
                    runDistance.value = '';
                    runTime.value = '';
                    runPace.value = '';
                    paceResult.textContent = '--:--';
                    runFeeling.value = 'æ­£å¸¸';
                    customFeeling.style.display = 'none';
                    customFeeling.value = '';
                    document.getElementById('runType').value = 'æ™¨è·‘';
                }
            });
            
            // è®¾ç½®å‚ä¸äººæ•°å¡ç‰‡ç‚¹å‡»äº‹ä»¶
            setupRunnersCardClick();
            
            // è®¾ç½®èµ„é‡‘ç®¡ç†
            setupFundsManagement();
            
            // è®¾ç½®æ¿€åŠ±æªæ–½ç¼–è¾‘
            setupRewardsEditing();
            
            // åˆå§‹åŒ–ç§¯åˆ†æ•°æ®
            updateAllPoints();
            
            // æ¸²æŸ“æ‰€æœ‰æ•°æ®
            updateDashboard();
            updateAllTabs();
            
            // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢
            setupTabs();
            
            // è®¾ç½®æ•°æ®ç®¡ç†åŠŸèƒ½
            setupDataManagement();
            
            console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        }

        // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
                    tab.classList.add('active');
                    const tabId = `${tab.dataset.tab}-tab`;
                    document.getElementById(tabId).classList.add('active');
                    
                    // æ›´æ–°å½“å‰æ ‡ç­¾çš„å†…å®¹
                    updateTabContent(tab.dataset.tab);
                });
            });
        }

        // æ›´æ–°æ ‡ç­¾é¡µå†…å®¹
        function updateTabContent(tabName) {
            console.log('æ›´æ–°æ ‡ç­¾é¡µ:', tabName);
            
            switch(tabName) {
                case 'weekly':
                    updateWeeklyRanking();
                    break;
                case 'monthly':
                    updateMonthlyRanking();
                    break;
                case 'yearly':
                    updateYearlyRanking();
                    break;
                case 'pace':
                    updatePaceRanking();
                    break;
                case 'night':
                    updateNightRanking();
                    break;
                case 'soul':
                    updateSoulRanking();
                    break;
                case 'consistency':
                    updateConsistencyRanking();
                    break;
                case 'runners':
                    updateRunnersList();
                    break;
                case 'rewards':
                    // æ¿€åŠ±æªæ–½é¡µé¢ä¸éœ€è¦ç‰¹æ®Šæ›´æ–°
                    break;
                case 'funds':
                    updateFundsDisplay();
                    break;
                case 'records':
                    updateRecordsTable();
                    break;
                case 'charts':
                    updateCharts();
                    break;
                case 'data-management':
                    // æ•°æ®ç®¡ç†é¡µä¸éœ€è¦ç‰¹æ®Šæ›´æ–°
                    break;
            }
        }

        // æ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
        function updateAllTabs() {
            updateWeeklyRanking();
            updateMonthlyRanking();
            updateYearlyRanking();
            updatePaceRanking();
            updateNightRanking();
            updateSoulRanking();
            updateConsistencyRanking();
            updateRunnersList();
            updateFundsDisplay();
            updateRecordsTable();
        }

        // æ›´æ–°ä»ªè¡¨æ¿æ•°æ®
        function updateDashboard() {
            const totalRuns = runningRecords.length;
            const totalDistance = runningRecords.reduce((sum, record) => sum + record.distance, 0);
            const runners = [...new Set(runningRecords.map(record => record.runner))];
            
            // è®¡ç®—å¹³å‡é…é€Ÿ
            let totalPaceSeconds = 0;
            runningRecords.forEach(record => {
                const [minutes, seconds] = record.pace.split(':').map(Number);
                totalPaceSeconds += (minutes * 60 + seconds) * record.distance;
            });
            
            let avgPace = '0:00';
            if (totalDistance > 0) {
                const avgPaceSeconds = totalPaceSeconds / totalDistance;
                const avgMinutes = Math.floor(avgPaceSeconds / 60);
                const avgSeconds = Math.round(avgPaceSeconds % 60);
                avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            }
            
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
            document.getElementById('totalRuns').textContent = totalRuns;
            document.getElementById('totalDistance').textContent = totalDistance.toFixed(1) + ' km';
            document.getElementById('totalRunners').textContent = runners.length;
            document.getElementById('avgPace').textContent = avgPace;
        }

        // æ›´æ–°å‘¨æ’å
        function updateWeeklyRanking() {
            const content = document.getElementById('weeklyContent');
            
            // è·å–æœ¬å‘¨æ—¥æœŸèŒƒå›´
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            startOfWeek.setHours(0, 0, 0, 0);
            
            // ç­›é€‰æœ¬å‘¨è®°å½•
            const weeklyRecords = runningRecords.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate >= startOfWeek;
            });
            
            // è®¡ç®—æ’å
            const ranking = calculateRanking(weeklyRecords);
            
            // ç”ŸæˆHTML
            if (ranking.length === 0) {
                content.innerHTML = '<div class="no-data">æœ¬å‘¨æš‚æ— æ‰“å¡è®°å½•</div>';
                return;
            }
            
            let html = '<table><thead><tr><th>æ’å</th><th>è·‘æ­¥è€…</th><th>æ€»é‡Œç¨‹ (km)</th><th>è·‘æ­¥æ¬¡æ•°</th><th>å¹³å‡é…é€Ÿ</th></tr></thead><tbody>';
            
            ranking.forEach((runner, index) => {
                const rankBadge = index < 3 ? 
                    `<span class="ranking-badge ${['gold', 'silver', 'bronze'][index]}">${index + 1}</span>` : 
                    `<span class="ranking-badge">${index + 1}</span>`;
                
                html += `<tr>
                    <td>${rankBadge}</td>
                    <td>${runner.name}</td>
                    <td>${runner.totalDistance.toFixed(1)}</td>
                    <td>${runner.count}</td>
                    <td>${runner.avgPace}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // æ›´æ–°æœˆæ’å
        function updateMonthlyRanking() {
            const content = document.getElementById('monthlyContent');
            
            // è·å–æœ¬æœˆæ—¥æœŸèŒƒå›´
            const today = new Date();
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            // ç­›é€‰æœ¬æœˆè®°å½•
            const monthlyRecords = runningRecords.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate >= startOfMonth;
            });
            
            // è®¡ç®—æ’å
            const ranking = calculateRanking(monthlyRecords);
            
            // ç”ŸæˆHTML
            if (ranking.length === 0) {
                content.innerHTML = '<div class="no-data">æœ¬æœˆæš‚æ— æ‰“å¡è®°å½•</div>';
                return;
            }
            
            let html = '<table><thead><tr><th>æ’å</th><th>è·‘æ­¥è€…</th><th>æ€»é‡Œç¨‹ (km)</th><th>è·‘æ­¥æ¬¡æ•°</th><th>å¹³å‡é…é€Ÿ</th></tr></thead><tbody>';
            
            ranking.forEach((runner, index) => {
                const rankBadge = index < 3 ? 
                    `<span class="ranking-badge ${['gold', 'silver', 'bronze'][index]}">${index + 1}</span>` : 
                    `<span class="ranking-badge">${index + 1}</span>`;
                
                html += `<tr>
                    <td>${rankBadge}</td>
                    <td>${runner.name}</td>
                    <td>${runner.totalDistance.toFixed(1)}</td>
                    <td>${runner.count}</td>
                    <td>${runner.avgPace}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // æ›´æ–°å¹´æ’å
        function updateYearlyRanking() {
            const content = document.getElementById('yearlyContent');
            
            // è·å–æœ¬å¹´æ—¥æœŸèŒƒå›´
            const today = new Date();
            const startOfYear = new Date(today.getFullYear(), 0, 1);
            
            // ç­›é€‰æœ¬å¹´è®°å½•
            const yearlyRecords = runningRecords.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate >= startOfYear;
            });
            
            // è®¡ç®—æ’å
            const ranking = calculateRanking(yearlyRecords);
            
            // ç”ŸæˆHTML
            if (ranking.length === 0) {
                content.innerHTML = '<div class="no-data">æœ¬å¹´æš‚æ— æ‰“å¡è®°å½•</div>';
                return;
            }
            
            let html = '<table><thead><tr><th>æ’å</th><th>è·‘æ­¥è€…</th><th>æ€»é‡Œç¨‹ (km)</th><th>è·‘æ­¥æ¬¡æ•°</th><th>å¹³å‡é…é€Ÿ</th></tr></thead><tbody>';
            
            ranking.forEach((runner, index) => {
                const rankBadge = index < 3 ? 
                    `<span class="ranking-badge ${['gold', 'silver', 'bronze'][index]}">${index + 1}</span>` : 
                    `<span class="ranking-badge">${index + 1}</span>`;
                
                html += `<tr>
                    <td>${rankBadge}</td>
                    <td>${runner.name}</td>
                    <td>${runner.totalDistance.toFixed(1)}</td>
                    <td>${runner.count}</td>
                    <td>${runner.avgPace}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // è®¡ç®—æ’å
        function calculateRanking(records) {
            const runnerStats = {};
            
            // ç»Ÿè®¡æ¯ä¸ªè·‘æ­¥è€…çš„æ•°æ®
            records.forEach(record => {
                if (!runnerStats[record.runner]) {
                    runnerStats[record.runner] = {
                        name: record.runner,
                        totalDistance: 0,
                        totalTime: 0,
                        count: 0,
                        totalPaceSeconds: 0
                    };
                }
                
                const stats = runnerStats[record.runner];
                stats.totalDistance += record.distance;
                stats.totalTime += record.time;
                stats.count += 1;
                
                // è®¡ç®—é…é€Ÿæ€»ç§’æ•°
                const [minutes, seconds] = record.pace.split(':').map(Number);
                stats.totalPaceSeconds += (minutes * 60 + seconds) * record.distance;
            });
            
            // è®¡ç®—å¹³å‡é…é€Ÿ
            Object.values(runnerStats).forEach(stats => {
                if (stats.totalDistance > 0) {
                    const avgPaceSeconds = stats.totalPaceSeconds / stats.totalDistance;
                    const avgMinutes = Math.floor(avgPaceSeconds / 60);
                    const avgSeconds = Math.round(avgPaceSeconds % 60);
                    stats.avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
                } else {
                    stats.avgPace = '0:00';
                }
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æ€»é‡Œç¨‹æ’åº
            return Object.values(runnerStats)
                .sort((a, b) => b.totalDistance - a.totalDistance);
        }

        // æ›´æ–°é…é€Ÿæ’è¡Œæ¦œ
        function updatePaceRanking() {
            const content = document.getElementById('paceContent');
            
            // è®¡ç®—æ¯ä¸ªè·‘æ­¥è€…çš„å¹³å‡é…é€Ÿ
            const runnerStats = {};
            
            runningRecords.forEach(record => {
                if (!runnerStats[record.runner]) {
                    runnerStats[record.runner] = {
                        name: record.runner,
                        totalDistance: 0,
                        totalPaceSeconds: 0
                    };
                }
                
                const stats = runnerStats[record.runner];
                stats.totalDistance += record.distance;
                
                // è®¡ç®—é…é€Ÿæ€»ç§’æ•°
                const [minutes, seconds] = record.pace.split(':').map(Number);
                stats.totalPaceSeconds += (minutes * 60 + seconds) * record.distance;
            });
            
            // è®¡ç®—å¹³å‡é…é€Ÿå¹¶è½¬æ¢ä¸ºå¯æ’åºçš„æ•°å€¼
            const paceRanking = Object.values(runnerStats)
                .filter(stats => stats.totalDistance > 0)
                .map(stats => {
                    const avgPaceSeconds = stats.totalDistance > 0 ? stats.totalPaceSeconds / stats.totalDistance : 0;
                    const avgMinutes = Math.floor(avgPaceSeconds / 60);
                    const avgSeconds = Math.round(avgPaceSeconds % 60);
                    
                    return {
                        name: stats.name,
                        avgPace: `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`,
                        paceValue: avgPaceSeconds // ç”¨äºæ’åº
                    };
                })
                .sort((a, b) => a.paceValue - b.paceValue); // é…é€Ÿè¶Šä½æ’åè¶Šé«˜
            
            // ç”ŸæˆHTML
            if (paceRanking.length === 0) {
                content.innerHTML = '<div class="no-data">æš‚æ— é…é€Ÿæ•°æ®</div>';
                return;
            }
            
            let html = '<table><thead><tr><th>æ’å</th><th>è·‘æ­¥è€…</th><th>å¹³å‡é…é€Ÿ</th></tr></thead><tbody>';
            
            paceRanking.forEach((runner, index) => {
                const rankBadge = index < 3 ? 
                    `<span class="ranking-badge ${['gold', 'silver', 'bronze'][index]}">${index + 1}</span>` : 
                    `<span class="ranking-badge">${index + 1}</span>`;
                
                html += `<tr>
                    <td>${rankBadge}</td>
                    <td>${runner.name}</td>
                    <td>${runner.avgPace}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // æ›´æ–°å¤œè·‘æ’è¡Œæ¦œ
        function updateNightRanking() {
            const content = document.getElementById('nightContent');
            
            // ç­›é€‰å¤œè·‘è®°å½•
            const nightRecords = runningRecords.filter(record => record.type === 'å¤œè·‘');
            
            if (nightRecords.length === 0) {
                content.innerHTML = '<div class="no-data">æš‚æ— å¤œè·‘è®°å½•</div>';
                return;
            }
            
            // ç»Ÿè®¡å¤œè·‘æ•°æ®
            const nightStats = {};
            nightRecords.forEach(record => {
                if (!nightStats[record.runner]) {
                    nightStats[record.runner] = {
                        name: record.runner,
                        totalDistance: 0,
                        count: 0,
                        totalPaceSeconds: 0,
                        lastRun: record.date
                    };
                }
                
                const stats = nightStats[record.runner];
                stats.totalDistance += record.distance;
                stats.count += 1;
                
                // è®¡ç®—é…é€Ÿæ€»ç§’æ•°
                const [minutes, seconds] = record.pace.split(':').map(Number);
                stats.totalPaceSeconds += (minutes * 60 + seconds) * record.distance;
                
                // æ›´æ–°æœ€åè·‘æ­¥æ—¥æœŸ
                if (record.date > stats.lastRun) {
                    stats.lastRun = record.date;
                }
            });
            
            // è®¡ç®—å¹³å‡é…é€Ÿ
            Object.values(nightStats).forEach(stats => {
                if (stats.totalDistance > 0) {
                    const avgPaceSeconds = stats.totalPaceSeconds / stats.totalDistance;
                    const avgMinutes = Math.floor(avgPaceSeconds / 60);
                    const avgSeconds = Math.round(avgPaceSeconds % 60);
                    stats.avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
                }
            });
            
            // æŒ‰å¤œè·‘æ¬¡æ•°æ’åº
            const nightRanking = Object.values(nightStats)
                .sort((a, b) => b.count - a.count);
            
            let html = `
                <div class="night-runner-section">
                    <div class="night-runner-title-main">ğŸ† å¤œè·‘ä¾ è£èª‰æ¦œ</div>
                    <p>è¯„é€‰æ ‡å‡†ï¼šå¤œè·‘æ¬¡æ•°æœ€å¤šçš„è·‘è€…å°†è·å¾—"å¤œè·‘ä¾ "ç§°å·ï¼</p>
                    
                    <div class="night-runner-grid">
            `;
            
            nightRanking.forEach((runner, index) => {
                const isTop = index === 0;
                html += `
                    <div class="night-runner-card ${isTop ? 'top' : ''}">
                        <div class="night-runner-name">${runner.name}</div>
                        <div class="night-runner-stats">
                            <div>å¤œè·‘æ¬¡æ•°: ${runner.count} æ¬¡</div>
                            <div>æ€»é‡Œç¨‹: ${runner.totalDistance.toFixed(1)} km</div>
                            <div>å¹³å‡é…é€Ÿ: ${runner.avgPace}</div>
                            ${isTop ? '<div style="color: var(--night-run); font-weight: bold; margin-top: 5px;">ğŸŒŸ å¤œè·‘ä¾ </div>' : ''}
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr class="night-run-header">
                            <th>æ’å</th>
                            <th>å¤œè·‘è€…</th>
                            <th>å¤œè·‘æ¬¡æ•°</th>
                            <th>å¤œè·‘æ€»é‡Œç¨‹</th>
                            <th>å¹³å‡é…é€Ÿ</th>
                            <th>æœ€åå¤œè·‘</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            nightRanking.forEach((runner, index) => {
                const rankBadge = index < 3 ? 
                    `<span class="ranking-badge ${['gold', 'silver', 'bronze'][index]}">${index + 1}</span>` : 
                    `<span class="ranking-badge">${index + 1}</span>`;
                
                html += `<tr>
                    <td>${rankBadge}</td>
                    <td>${runner.name} ${index === 0 ? 'ğŸŒŸ' : ''}</td>
                    <td>${runner.count}</td>
                    <td>${runner.totalDistance.toFixed(1)} km</td>
                    <td>${runner.avgPace}</td>
                    <td>${runner.lastRun}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // æ›´æ–°å¿ƒçµè·‘è€…æ’è¡Œæ¦œ
        function updateSoulRanking() {
            const content = document.getElementById('soulContent');
            
            // ç­›é€‰ç”¨å¿ƒæ„Ÿå—çš„è®°å½•
            const heartfeltRecords = runningRecords.filter(record => 
                isHeartfeltFeeling(record.feeling)
            );
            
            if (heartfeltRecords.length === 0) {
                content.innerHTML = '<div class="no-data">æš‚æ— ç”¨å¿ƒæ„Ÿå—è®°å½•ï¼Œé¼“åŠ±å¤§å®¶å¤šåˆ†äº«è·‘æ­¥æ—¶çš„çœŸå®æ„Ÿå—ï¼</div>';
                return;
            }
            
            // æŒ‰è·‘æ­¥è€…åˆ†ç»„ç”¨å¿ƒæ„Ÿå—
            const soulStats = {};
            heartfeltRecords.forEach(record => {
                if (!soulStats[record.runner]) {
                    soulStats[record.runner] = {
                        name: record.runner,
                        heartfeltCount: 0,
                        totalDistance: 0,
                        feelings: []
                    };
                }
                
                const stats = soulStats[record.runner];
                stats.heartfeltCount += 1;
                stats.totalDistance += record.distance;
                stats.feelings.push({
                    date: record.date,
                    feeling: record.feeling,
                    distance: record.distance
                });
            });
            
            // æŒ‰ç”¨å¿ƒæ„Ÿå—æ¬¡æ•°æ’åº
            const soulRanking = Object.values(soulStats)
                .sort((a, b) => b.heartfeltCount - a.heartfeltCount);
            
            let html = `
                <div class="soul-runner-section">
                    <div class="soul-runner-title-main">ğŸ’– å¿ƒçµè·‘è€…è£èª‰æ¦œ</div>
                    <p>è¯„é€‰æ ‡å‡†ï¼šåˆ†äº«çœŸå®ã€ç”¨å¿ƒè·‘æ­¥æ„Ÿå—çš„è·‘è€…å°†è·å¾—"å¿ƒçµè·‘è€…"ç§°å·ï¼</p>
                    
                    <div class="soul-runner-grid">
            `;
            
            soulRanking.forEach((runner, index) => {
                const isTop = index === 0;
                html += `
                    <div class="soul-runner-card ${isTop ? 'top' : ''}">
                        <div class="soul-runner-name">${runner.name}</div>
                        <div class="soul-runner-stats">
                            <div>ç”¨å¿ƒæ„Ÿå—: ${runner.heartfeltCount} æ¬¡</div>
                            <div>æ€»é‡Œç¨‹: ${runner.totalDistance.toFixed(1)} km</div>
                            ${isTop ? '<div style="color: var(--soul-run); font-weight: bold; margin-top: 5px;">ğŸ’« å¿ƒçµè·‘è€…</div>' : ''}
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                
                <h3>ç”¨å¿ƒæ„Ÿå—åˆ†äº«</h3>
                <table>
                    <thead>
                        <tr class="soul-run-header">
                            <th>è·‘æ­¥è€…</th>
                            <th>æ—¥æœŸ</th>
                            <th>é‡Œç¨‹</th>
                            <th>ç”¨å¿ƒæ„Ÿå—</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            heartfeltRecords
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .forEach(record => {
                    html += `<tr>
                        <td>${record.runner}</td>
                        <td>${record.date}</td>
                        <td>${record.distance} km</td>
                        <td>
                            <span class="feeling-badge feeling-custom-style">${record.feeling}</span>
                        </td>
                    </tr>`;
                });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // æ›´æ–°åšæŒå¤©æ•°æ’è¡Œæ¦œ
        function updateConsistencyRanking() {
            const content = document.getElementById('consistencyContent');
            
            // è®¡ç®—æ¯ä¸ªè·‘æ­¥è€…çš„è·‘æ­¥å¤©æ•°
            const runnerDays = {};
            
            runningRecords.forEach(record => {
                if (!runnerDays[record.runner]) {
                    runnerDays[record.runner] = new Set();
                }
                runnerDays[record.runner].add(record.date);
            });
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
            const consistencyRanking = Object.entries(runnerDays)
                .map(([name, daysSet]) => ({
                    name,
                    days: daysSet.size
                }))
                .sort((a, b) => b.days - a.days);
            
            // ç”ŸæˆHTML
            if (consistencyRanking.length === 0) {
                content.innerHTML = '<div class="no-data">æš‚æ— åšæŒå¤©æ•°æ•°æ®</div>';
                return;
            }
            
            let html = '<table><thead><tr><th>æ’å</th><th>è·‘æ­¥è€…</th><th>åšæŒå¤©æ•°</th></tr></thead><tbody>';
            
            consistencyRanking.forEach((runner, index) => {
                const rankBadge = index < 3 ? 
                    `<span class="ranking-badge ${['gold', 'silver', 'bronze'][index]}">${index + 1}</span>` : 
                    `<span class="ranking-badge">${index + 1}</span>`;
                
                html += `<tr>
                    <td>${rankBadge}</td>
                    <td>${runner.name}</td>
                    <td>${runner.days} å¤©</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // æ›´æ–°æ‰“å¡è®°å½•è¡¨æ ¼
        function updateRecordsTable() {
            const content = document.getElementById('recordsContent');
            
            if (runningRecords.length === 0) {
                content.innerHTML = '<div class="no-data">æš‚æ— æ‰“å¡è®°å½•</div>';
                return;
            }
            
            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            const sortedRecords = [...runningRecords].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            let html = '<table><thead><tr><th>æ—¥æœŸ</th><th>è·‘æ­¥è€…</th><th>é‡Œç¨‹ (km)</th><th>æ—¶é•¿ (åˆ†é’Ÿ)</th><th>é…é€Ÿ</th><th>æ„Ÿå—</th><th>æ™¨è·‘/å¤œè·‘</th></tr></thead><tbody>';
            
            sortedRecords.forEach(record => {
                const feelingClass = getFeelingClass(record.feeling);
                const timeTypeClass = record.type === 'æ™¨è·‘' ? 'morning-run' : 'night-run';
                
                html += `<tr>
                    <td>${record.date}</td>
                    <td>${record.runner}</td>
                    <td>${record.distance.toFixed(1)}</td>
                    <td>${record.time}</td>
                    <td>${record.pace}</td>
                    <td><span class="feeling-badge ${feelingClass}">${record.feeling}</span></td>
                    <td><span class="time-type-badge ${timeTypeClass}">${record.type}</span></td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            const content = document.getElementById('chartsContent');
            
            if (runningRecords.length === 0) {
                content.innerHTML = '<div class="no-data">æš‚æ— æ•°æ®å¯ç”Ÿæˆå›¾è¡¨</div>';
                return;
            }
            
            // åˆ›å»ºå›¾è¡¨å®¹å™¨
            content.innerHTML = `
                <div class="chart-container">
                    <canvas id="distanceChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="paceChart"></canvas>
                </div>
            `;
            
            // ç»˜åˆ¶è·ç¦»å›¾è¡¨
            const distanceCtx = document.getElementById('distanceChart').getContext('2d');
            
            // æŒ‰è·‘æ­¥è€…åˆ†ç»„è·ç¦»æ•°æ®
            const runnerDistances = {};
            runningRecords.forEach(record => {
                if (!runnerDistances[record.runner]) {
                    runnerDistances[record.runner] = 0;
                }
                runnerDistances[record.runner] += record.distance;
            });
            
            new Chart(distanceCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(runnerDistances),
                    datasets: [{
                        label: 'æ€»é‡Œç¨‹ (km)',
                        data: Object.values(runnerDistances),
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(155, 89, 182, 0.7)',
                            'rgba(241, 196, 15, 0.7)',
                            'rgba(230, 126, 34, 0.7)'
                        ],
                        borderColor: [
                            'rgb(52, 152, 219)',
                            'rgb(46, 204, 113)',
                            'rgb(155, 89, 182)',
                            'rgb(241, 196, 15)',
                            'rgb(230, 126, 34)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é‡Œç¨‹ (km)'
                            }
                        }
                    }
                }
            });
            
            // ç»˜åˆ¶é…é€Ÿå›¾è¡¨
            const paceCtx = document.getElementById('paceChart').getContext('2d');
            
            // è®¡ç®—æ¯ä¸ªè·‘æ­¥è€…çš„å¹³å‡é…é€Ÿ
            const runnerPaces = {};
            runningRecords.forEach(record => {
                if (!runnerPaces[record.runner]) {
                    runnerPaces[record.runner] = {
                        totalPaceSeconds: 0,
                        totalDistance: 0
                    };
                }
                
                const [minutes, seconds] = record.pace.split(':').map(Number);
                runnerPaces[record.runner].totalPaceSeconds += (minutes * 60 + seconds) * record.distance;
                runnerPaces[record.runner].totalDistance += record.distance;
            });
            
            const paceData = Object.entries(runnerPaces).map(([runner, data]) => {
                const avgPaceSeconds = data.totalDistance > 0 ? data.totalPaceSeconds / data.totalDistance : 0;
                return {
                    runner,
                    pace: avgPaceSeconds / 60 // è½¬æ¢ä¸ºåˆ†é’Ÿ
                };
            });
            
            new Chart(paceCtx, {
                type: 'bar',
                data: {
                    labels: paceData.map(item => item.runner),
                    datasets: [{
                        label: 'å¹³å‡é…é€Ÿ (åˆ†é’Ÿ/å…¬é‡Œ)',
                        data: paceData.map(item => parseFloat(item.pace.toFixed(2))),
                        backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        borderColor: 'rgb(231, 76, 60)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é…é€Ÿ (åˆ†é’Ÿ/å…¬é‡Œ)'
                            }
                        }
                    }
                }
            });
        }

        // è®¾ç½®æ•°æ®ç®¡ç†åŠŸèƒ½
        function setupDataManagement() {
            const exportJsonBtn = document.getElementById('exportJsonBtn');
            const exportCsvBtn = document.getElementById('exportCsvBtn');
            const copyDataBtn = document.getElementById('copyDataBtn');
            const importFile = document.getElementById('importFile');
            const importDataBtn = document.getElementById('importDataBtn');
            const clearDataBtn = document.getElementById('clearDataBtn');
            
            // å¯¼å‡ºJSON
            exportJsonBtn.addEventListener('click', function() {
                const dataStr = JSON.stringify(runningRecords, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'æ± å·æ‚¦è·‘å›¢æ•°æ®.json';
                link.click();
                URL.revokeObjectURL(url);
                
                showMessage('JSONæ•°æ®å¯¼å‡ºæˆåŠŸï¼', 'success');
            });
            
            // å¯¼å‡ºCSV
            exportCsvBtn.addEventListener('click', function() {
                let csvContent = "è·‘æ­¥è€…,æ—¥æœŸ,é‡Œç¨‹(km),æ—¶é•¿(åˆ†é’Ÿ),é…é€Ÿ(min/km),æ„Ÿå—,æ™¨è·‘/å¤œè·‘\n";
                
                runningRecords.forEach(record => {
                    csvContent += `"${record.runner}","${record.date}",${record.distance},${record.time},"${record.pace}","${record.feeling}","${record.type}"\n`;
                });
                
                const dataBlob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'æ± å·æ‚¦è·‘å›¢æ•°æ®.csv';
                link.click();
                URL.revokeObjectURL(url);
                
                showMessage('CSVæ•°æ®å¯¼å‡ºæˆåŠŸï¼', 'success');
            });
            
            // å¤åˆ¶æ•°æ®åˆ°å‰ªè´´æ¿
            copyDataBtn.addEventListener('click', function() {
                const dataStr = JSON.stringify(runningRecords, null, 2);
                
                navigator.clipboard.writeText(dataStr).then(() => {
                    showMessage('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥: ', err);
                    showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                });
            });
            
            // å¯¼å…¥æ•°æ®
            importDataBtn.addEventListener('click', async function() {
                console.log('å¼€å§‹å¯¼å…¥æ•°æ®...');
                
                if (!importFile.files.length) {
                    showMessage('è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶', 'error');
                    return;
                }
                
                const file = importFile.files[0];
                console.log('é€‰æ‹©çš„æ–‡ä»¶:', file.name, 'å¤§å°:', file.size, 'ç±»å‹:', file.type);
                
                const reader = new FileReader();
                
                reader.onload = async function(e) {
                    console.log('æ–‡ä»¶è¯»å–å®Œæˆ');
                    try {
                        let importedRecords = [];
                        const fileContent = e.target.result;
                        console.log('æ–‡ä»¶å†…å®¹é•¿åº¦:', fileContent.length);
                        
                        if (file.name.endsWith('.json')) {
                            console.log('å¤„ç†JSONæ–‡ä»¶');
                            // å¯¼å…¥JSONæ ¼å¼
                            importedRecords = JSON.parse(fileContent);
                            console.log('è§£æå‡ºçš„è®°å½•æ•°:', importedRecords.length);
                        } else if (file.name.endsWith('.csv')) {
                            console.log('å¤„ç†CSVæ–‡ä»¶');
                            // å¯¼å…¥CSVæ ¼å¼
                            importedRecords = parseCsvData(fileContent);
                            console.log('è§£æå‡ºçš„è®°å½•æ•°:', importedRecords.length);
                        } else {
                            showMessage('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œè¯·ä½¿ç”¨JSONæˆ–CSVæ–‡ä»¶', 'error');
                            return;
                        }
                        
                        // éªŒè¯æ•°æ®æ ¼å¼
                        if (!Array.isArray(importedRecords)) {
                            console.error('æ•°æ®ä¸æ˜¯æ•°ç»„æ ¼å¼:', typeof importedRecords);
                            showMessage('æ•°æ®æ ¼å¼é”™è¯¯ï¼šåº”ä¸ºæ•°ç»„æ ¼å¼', 'error');
                            return;
                        }
                        
                        console.log('å¼€å§‹éªŒè¯è®°å½•...');
                        // éªŒè¯æ¯æ¡è®°å½•
                        let validRecords = 0;
                        let duplicateRecords = 0;
                        let invalidRecords = 0;
                        
                        // æ‰¹é‡ä¿å­˜åˆ°LeanCloud
                        for (const record of importedRecords) {
                            console.log(`éªŒè¯è®°å½•:`, record);
                            
                            if (isValidRecord(record)) {
                                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒè®°å½•ï¼ˆåŒä¸€ä¸ªäººåŒä¸€å¤©ï¼‰
                                const exists = runningRecords.some(r => 
                                    r.runner === record.runner && r.date === record.date
                                );
                                
                                if (!exists) {
                                    // ä¿å­˜åˆ°LeanCloud
                                    const success = await saveRunningRecord(record);
                                    if (success) {
                                        runningRecords.push(record);
                                        validRecords++;
                                        console.log(`è®°å½•éªŒè¯é€šè¿‡å¹¶æ·»åŠ `);
                                    }
                                } else {
                                    duplicateRecords++;
                                    console.log(`è®°å½•é‡å¤ï¼Œè·³è¿‡`);
                                }
                            } else {
                                invalidRecords++;
                                console.log(`è®°å½•éªŒè¯å¤±è´¥`, record);
                            }
                        }
                        
                        // æ›´æ–°ç•Œé¢
                        updateDashboard();
                        updateAllTabs();
                        
                        let message = `æˆåŠŸå¯¼å…¥ ${validRecords} æ¡è®°å½•ï¼`;
                        if (duplicateRecords > 0) {
                            message += ` è·³è¿‡ ${duplicateRecords} æ¡é‡å¤è®°å½•`;
                        }
                        if (invalidRecords > 0) {
                            message += ` å¿½ç•¥ ${invalidRecords} æ¡æ— æ•ˆè®°å½•`;
                        }
                        
                        showMessage(message, 'success');
                        importFile.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                        
                    } catch (error) {
                        console.error('å¯¼å…¥æ•°æ®æ—¶å‡ºé”™:', error);
                        showMessage('å¯¼å…¥å¤±è´¥ï¼š' + error.message, 'error');
                    }
                };
                
                reader.onerror = function(e) {
                    console.error('æ–‡ä»¶è¯»å–é”™è¯¯:', e);
                    showMessage('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                };
                
                reader.readAsText(file);
            });
            
            // æ¸…ç©ºæ•°æ®
            clearDataBtn.addEventListener('click', async function() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    try {
                        // åˆ é™¤LeanCloudä¸­çš„æ‰€æœ‰è®°å½•
                        const query = new AV.Query('RunRecord');
                        const records = await query.find();
                        
                        for (const record of records) {
                            await record.destroy();
                        }
                        
                        runningRecords = [];
                        updateDashboard();
                        updateAllTabs();
                        showMessage('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
                    } catch (error) {
                        console.error('æ¸…ç©ºæ•°æ®å¤±è´¥:', error);
                        showMessage('æ¸…ç©ºæ•°æ®å¤±è´¥: ' + error.message, 'error');
                    }
                }
            });
        }

        // è§£æCSVæ•°æ®
        function parseCsvData(csvContent) {
            console.log('å¼€å§‹è§£æCSVæ•°æ®');
            const lines = csvContent.split('\n').filter(line => line.trim());
            console.log('CSVè¡Œæ•°:', lines.length);
            
            const records = [];
            
            if (lines.length === 0) {
                return records;
            }
            
            // è§£æè¡¨å¤´ - æ£€æµ‹åˆ†éš”ç¬¦
            const firstLine = lines[0];
            const hasTabs = firstLine.includes('\t');
            const hasCommas = firstLine.includes(',');
            const delimiter = hasTabs ? '\t' : (hasCommas ? ',' : '\t'); // ä¼˜å…ˆåˆ¶è¡¨ç¬¦
            
            console.log('æ£€æµ‹åˆ°çš„åˆ†éš”ç¬¦:', delimiter === '\t' ? 'åˆ¶è¡¨ç¬¦' : 'é€—å·');
            
            const headers = firstLine.split(delimiter).map(header => header.trim().replace(/^"|"$/g, ''));
            console.log('CSVè¡¨å¤´:', headers);
            
            // æ™ºèƒ½æ˜ å°„å­—æ®µ
            const fieldMap = {};
            headers.forEach((header, index) => {
                const lowerHeader = header.toLowerCase();
                if (lowerHeader.includes('è·‘è€…') || lowerHeader.includes('å§“å') || lowerHeader.includes('name') || lowerHeader.includes('runner')) {
                    fieldMap.runner = index;
                } else if (lowerHeader.includes('æ—¥æœŸ') || lowerHeader.includes('date')) {
                    fieldMap.date = index;
                } else if (lowerHeader.includes('é‡Œç¨‹') || lowerHeader.includes('è·ç¦»') || lowerHeader.includes('distance')) {
                    fieldMap.distance = index;
                } else if (lowerHeader.includes('æ—¶é•¿') || lowerHeader.includes('æ—¶é—´') || lowerHeader.includes('time')) {
                    fieldMap.time = index;
                } else if (lowerHeader.includes('é…é€Ÿ') || lowerHeader.includes('pace')) {
                    fieldMap.pace = index;
                } else if (lowerHeader.includes('æ„Ÿå—') || lowerHeader.includes('æ„Ÿè§‰') || lowerHeader.includes('feeling')) {
                    fieldMap.feeling = index;
                } else if (lowerHeader.includes('ç±»å‹') || lowerHeader.includes('æ™¨è·‘') || lowerHeader.includes('å¤œè·‘') || lowerHeader.includes('type')) {
                    fieldMap.type = index;
                }
            });
            
            console.log('å­—æ®µæ˜ å°„:', fieldMap);
            
            // è·³è¿‡è¡¨å¤´ï¼Œä»ç¬¬1è¡Œå¼€å§‹ï¼ˆç´¢å¼•1ï¼‰
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                console.log(`è§£æç¬¬ ${i} è¡Œ:`, line);
                
                try {
                    // ä½¿ç”¨æ£€æµ‹åˆ°çš„åˆ†éš”ç¬¦è§£æ
                    const parts = line.split(delimiter).map(part => part.trim().replace(/^"|"$/g, ''));
                    console.log(`è§£æå‡ºçš„å­—æ®µ:`, parts);
                    
                    if (parts.length >= 5) { // è‡³å°‘éœ€è¦5ä¸ªåŸºæœ¬å­—æ®µ
                        // ä½¿ç”¨æ™ºèƒ½å­—æ®µæ˜ å°„åˆ›å»ºè®°å½•
                        const record = {
                            runner: parts[fieldMap.runner] || parts[0] || '',
                            date: parts[fieldMap.date] || parts[1] || '',
                            distance: parseFloat(parts[fieldMap.distance] || parts[2]) || 0,
                            time: parseFloat(parts[fieldMap.time] || parts[3]) || 0, // æ”¹ä¸ºparseFloatæ”¯æŒå°æ•°
                            pace: parts[fieldMap.pace] || parts[4] || '',
                            feeling: parts[fieldMap.feeling] || parts[5] || 'æ­£å¸¸',
                            type: parts[fieldMap.type] || parts[6] || 'æ™¨è·‘'
                        };
                        
                        console.log(`åˆ›å»ºçš„è®°å½•å¯¹è±¡:`, record);
                        
                        if (isValidRecord(record)) {
                            records.push(record);
                            console.log(`è®°å½• ${i} éªŒè¯é€šè¿‡`);
                        } else {
                            console.log(`è®°å½• ${i} éªŒè¯å¤±è´¥`);
                        }
                    } else {
                        console.log(`ç¬¬ ${i} è¡Œå­—æ®µæ•°é‡ä¸è¶³: ${parts.length}`);
                    }
                } catch (error) {
                    console.error(`è§£æç¬¬ ${i} è¡Œæ—¶å‡ºé”™:`, error);
                }
            }
            
            console.log('æœ€ç»ˆè§£æå‡ºçš„è®°å½•æ•°:', records.length);
            return records;
        }

        // éªŒè¯è®°å½•æ ¼å¼
        function isValidRecord(record) {
            console.log('éªŒè¯è®°å½•:', record);
            
            // æ£€æŸ¥å¿…éœ€å­—æ®µ
            if (!record.runner || typeof record.runner !== 'string' || record.runner.trim() === '') {
                console.log('è·‘æ­¥è€…å§“åæ— æ•ˆ');
                return false;
            }
            
            if (!record.date || typeof record.date !== 'string') {
                console.log('æ—¥æœŸæ— æ•ˆ');
                return false;
            }
            
            // å¤„ç†Excelæ—¥æœŸæ ¼å¼ï¼ˆæ•°å­—æ ¼å¼ï¼‰
            let dateStr = record.date.trim();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯Excelæ•°å­—æ—¥æœŸï¼ˆå¦‚45940ï¼‰
            if (/^\d+$/.test(dateStr)) {
                console.log('æ£€æµ‹åˆ°Excelæ•°å­—æ—¥æœŸ:', dateStr);
                // Excelæ—¥æœŸæ˜¯ä»1900-01-01å¼€å§‹çš„å¤©æ•°
                const excelDate = parseInt(dateStr);
                // Excelçš„æ—¥æœŸç³»ç»Ÿä»1900-01-01å¼€å§‹ï¼ˆä½†Excelé”™è¯¯åœ°å°†1900å¹´è§†ä¸ºé—°å¹´ï¼‰
                const baseDate = new Date(1900, 0, 1);
                baseDate.setDate(baseDate.getDate() + excelDate - 2); // -2 ä¿®æ­£Excelçš„æ—¥æœŸé”™è¯¯
                
                const year = baseDate.getFullYear();
                const month = String(baseDate.getMonth() + 1).padStart(2, '0');
                const day = String(baseDate.getDate()).padStart(2, '0');
                record.date = `${year}-${month}-${day}`;
                console.log('è½¬æ¢åçš„æ—¥æœŸ:', record.date);
            } else {
                // å¤„ç†å…¶ä»–æ—¥æœŸæ ¼å¼
                const dateRegex = /^\d{4}[-/.]\d{1,2}[-/.]\d{1,2}$|^\d{1,2}[-/.]\d{1,2}[-/.]\d{4}$/;
                if (!dateRegex.test(dateStr)) {
                    console.log('æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®:', dateStr);
                    return false;
                }
                
                // å°è¯•è§£ææ—¥æœŸ
                try {
                    const parsedDate = new Date(dateStr);
                    if (isNaN(parsedDate.getTime())) {
                        console.log('æ—¥æœŸæ— æ³•è§£æ:', dateStr);
                        return false;
                    }
                    
                    const year = parsedDate.getFullYear();
                    const month = String(parsedDate.getMonth() + 1).padStart(2, '0');
                    const day = String(parsedDate.getDate()).padStart(2, '0');
                    record.date = `${year}-${month}-${day}`;
                    console.log('æ ¼å¼åŒ–åçš„æ—¥æœŸ:', record.date);
                    
                } catch (error) {
                    console.log('æ—¥æœŸè§£æé”™è¯¯:', error);
                    return false;
                }
            }
            
            if (typeof record.distance !== 'number' || record.distance <= 0 || isNaN(record.distance)) {
                console.log('é‡Œç¨‹æ— æ•ˆ:', record.distance);
                return false;
            }
            
            if (typeof record.time !== 'number' || record.time <= 0 || isNaN(record.time)) {
                console.log('æ—¶é•¿æ— æ•ˆ:', record.time);
                return false;
            }
            
            // å¤„ç†é…é€Ÿé—®é¢˜ - æ‚¨çš„æ•°æ®ä¸­é…é€Ÿæ˜¯å°æ•°æ ¼å¼
            if (!record.pace || typeof record.pace !== 'string') {
                console.log('é…é€Ÿæ— æ•ˆ');
                return false;
            }
            
            const paceStr = record.pace.trim();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯å°æ•°æ ¼å¼çš„é…é€Ÿï¼ˆå¦‚0.265972222222222ï¼‰
            if (/^\d+\.\d+$/.test(paceStr)) {
                console.log('æ£€æµ‹åˆ°å°æ•°é…é€Ÿ:', paceStr);
                // å°†å°æ•°è½¬æ¢ä¸ºåˆ†é’Ÿ:ç§’æ ¼å¼
                const paceDecimal = parseFloat(paceStr);
                const totalSeconds = paceDecimal * 24 * 60 * 60; // è½¬æ¢ä¸ºç§’ï¼ˆExcelæ—¶é—´æ ¼å¼ï¼‰
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = Math.round(totalSeconds % 60);
                record.pace = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                console.log('è½¬æ¢åçš„é…é€Ÿ:', record.pace);
            } else {
                // å¤„ç†æ ‡å‡†é…é€Ÿæ ¼å¼
                const paceRegex = /^\d+[:ï¼š]\d{1,2}$/; // æ”¯æŒä¸­æ–‡å†’å·
                if (!paceRegex.test(paceStr)) {
                    console.log('é…é€Ÿæ ¼å¼ä¸æ­£ç¡®:', paceStr);
                    return false;
                }
                
                // ç»Ÿä¸€é…é€Ÿæ ¼å¼ï¼ˆå°†ä¸­æ–‡å†’å·æ”¹ä¸ºè‹±æ–‡å†’å·ï¼‰
                record.pace = paceStr.replace('ï¼š', ':');
            }
            
            if (!record.feeling || typeof record.feeling !== 'string') {
                console.log('æ„Ÿå—æ— æ•ˆ');
                return false;
            }
            
            // å®½æ¾çš„è·‘æ­¥ç±»å‹éªŒè¯
            const typeStr = (record.type || '').trim();
            if (typeStr !== 'æ™¨è·‘' && typeStr !== 'å¤œè·‘') {
                console.log('è·‘æ­¥ç±»å‹æ— æ•ˆ:', typeStr);
                // å°è¯•è‡ªåŠ¨ä¿®æ­£
                if (typeStr.includes('æ™¨') || typeStr.includes('æ—©') || typeStr.includes('morning')) {
                    record.type = 'æ™¨è·‘';
                } else if (typeStr.includes('å¤œ') || typeStr.includes('æ™š') || typeStr.includes('night')) {
                    record.type = 'å¤œè·‘';
                } else {
                    record.type = 'æ™¨è·‘'; // é»˜è®¤å€¼
                }
            }
            
            console.log('è®°å½•éªŒè¯é€šè¿‡');
            return true;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>